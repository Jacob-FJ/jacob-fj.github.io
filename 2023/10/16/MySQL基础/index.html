<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Author Name,name@example.com"><title>Mysql基础 · Jacob Fang</title><meta name="description" content="基本概念DB
数据库(database)：存在数据的仓库，保存了一系列有组织的数据。



DBMS
数据库管理系统(Database Management System)：数据库是通过DBMS创建和操作的数据容器
常见的数据库管理系统：MySQL, Oracle, DB2, SqlServer
分"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Jacob Fang</a></h3><div class="description"><p>Nothing lasts forever.</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a target="_blank" rel="noopener" href="https://www.caicai.me"> CaiCai </a><span>&</span><a target="_blank" rel="noopener" href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Mysql基础</a></h3></div><div class="post-content"><h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="DB"><a href="#DB" class="headerlink" title="DB"></a><strong>DB</strong></h2><ul>
<li>数据库(database)：存在数据的仓库，保存了一系列有组织的数据。</li>
</ul>
<span id="more"></span>

<h2 id="DBMS"><a href="#DBMS" class="headerlink" title="DBMS"></a><strong>DBMS</strong></h2><ul>
<li>数据库管理系统(Database Management System)：数据库是通过DBMS创建和操作的数据容器</li>
<li>常见的数据库管理系统：MySQL, Oracle, DB2, SqlServer</li>
<li>分为两类：<ul>
<li>基于共享文件系统的DBMS<ul>
<li>Access</li>
<li>只需要安装一端</li>
</ul>
</li>
<li>基于客户机——服务器（C&#x2F;S架构）的DBMS<ul>
<li>如MySQL, Oracle, SqlServer</li>
<li>需要安装客户端和服务端</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a><strong>SQL</strong></h2><ul>
<li>结构化查询语言(Structure Query Language)：专门用来与数据库通信的语言</li>
<li>不是某个特定数据库供应商的专有语言，几乎所有的DBMS都支持SQL</li>
</ul>
<h2 id="数据库特点"><a href="#数据库特点" class="headerlink" title="数据库特点"></a>数据库特点</h2><ul>
<li>数据存在表中，表再放在库中</li>
<li>一个数据库可以有多个表，每个表都有一个名字用来标识自己。表名具有唯一性</li>
<li>表具有一些特性，这此特性定义了数据在表中如何存储</li>
<li>表由列组成，也称为<strong>字段</strong>，所有的表都是由一个或多个列组成的</li>
<li>表中的数据按行存储</li>
</ul>
<h2 id="MySQL-服务启动与停止"><a href="#MySQL-服务启动与停止" class="headerlink" title="MySQL 服务启动与停止"></a>MySQL 服务启动与停止</h2><ul>
<li><p>Method 1</p>
<ul>
<li>此电脑  -&gt; 管理 -&gt; 服务和应用程序 -&gt; 服务 -&gt; 找到mysql服务名称，右键启动或关闭</li>
</ul>
</li>
<li><p>Method 2</p>
<ul>
<li>命令行（以管理员身份打开）</li>
<li>关闭<code>net stop mysqlfj(服务名) </code></li>
<li>启动<code>net start mysqlfj(服务名)</code></li>
</ul>
</li>
</ul>
<h2 id="Mysql-服务端的登录和退出"><a href="#Mysql-服务端的登录和退出" class="headerlink" title="Mysql 服务端的登录和退出"></a>Mysql 服务端的登录和退出</h2><ul>
<li><p>Method 1</p>
<ul>
<li><p>命令行（管理员身份）：</p>
</li>
<li><p><code>mysql [-h(主机) localhost -P(端口号) 3306] -u root -p(密码)(密码可直接跟在后面或者回车后再输入，跟在后面不能有空格) </code></p>
</li>
<li><p>在命令行环境中<code>exit</code>或<code>Ctrl + C</code>退出服务</p>
</li>
</ul>
</li>
<li><p>Method 2</p>
<ul>
<li>通过mysql自带的客户端，但只限于root用户</li>
</ul>
</li>
</ul>
<h2 id="MySQL常见命令"><a href="#MySQL常见命令" class="headerlink" title="MySQL常见命令"></a>MySQL常见命令</h2><ul>
<li><p>查看当前所有的数据库：<code>show databases ;</code></p>
</li>
<li><p>打开指定的库：<code>use 库名 ;</code></p>
</li>
<li><p>查看当前库的所有表：<code>show tables ;</code></p>
</li>
<li><p>查看其它库的所有表：<code>show tables from 库名 ;</code></p>
</li>
<li><p>创建一个表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">	列名<span class="number">1</span> 列类型,</span><br><span class="line">     列名<span class="number">2</span> 列类型，</span><br><span class="line">     ...);</span><br></pre></td></tr></table></figure>


</li>
<li><p>查看表的结构：<code>desc 表名</code></p>
</li>
<li><p>查看服务器的版本</p>
<ul>
<li>Method 1， 在mysql服务端内：<code>select version() ;</code></li>
<li>Method 2, 在dos中<code>mysql --version</code>或<code>mysql -V</code></li>
</ul>
</li>
</ul>
<h2 id="MySQL语法规范"><a href="#MySQL语法规范" class="headerlink" title="MySQL语法规范"></a>MySQL语法规范</h2><ol>
<li>不区分大小写，但建议关键字大写，表名、列名小写</li>
<li>每条命令用分号结尾</li>
<li>每条命令根据需要，可以进行缩进和换行</li>
<li>注释<ol>
<li>单行注释<ul>
<li><code># 注释文字</code></li>
<li><code>-- 注释文字</code></li>
</ul>
</li>
<li>多行注释<ul>
<li><code>/* 注释文字 */</code></li>
</ul>
</li>
</ol>
</li>
</ol>
<h1 id="DQL语言"><a href="#DQL语言" class="headerlink" title="DQL语言"></a>DQL语言</h1><ul>
<li>DQL ：Data query language</li>
</ul>
<h2 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h2><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表名 ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>特点</p>
<ol>
<li>查询列表可以是：表中的字段、常量、表达式、函数</li>
<li>查询的结果是一个<strong>虚拟的表格</strong>，不是真实存在的</li>
</ol>
</li>
<li><p>着重号(&#96;&#96;)</p>
<ul>
<li>当关键字和字段名冲突时，用着重号表明这个是字段名</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1</span>、查询单个字段</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  last_name </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  employees ;</span><br><span class="line"></span><br><span class="line">#<span class="number">2</span>、查询表中的多个字段</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  last_name,</span><br><span class="line">  salary,</span><br><span class="line">  email </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  employees ;</span><br><span class="line"></span><br><span class="line">#<span class="number">3</span>、查询表中的所有字段</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Method</span> <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"></span><br><span class="line">  <span class="operator">*</span> <span class="keyword">FROM</span></span><br><span class="line">      employees ;</span><br><span class="line"></span><br><span class="line"># <span class="keyword">Method</span> <span class="number">2</span>:(在表的栏位中，对需要的字段双击)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  `employee_id`,</span><br><span class="line">  `first_name`,</span><br><span class="line">  `last_name`,</span><br><span class="line">  `email`,</span><br><span class="line">  `phone_number`,</span><br><span class="line">  `job_id`,</span><br><span class="line">  `salary`,</span><br><span class="line">  `commission_pct`,</span><br><span class="line">  `manager_id`,</span><br><span class="line">  `department_id`,</span><br><span class="line">  `hiredate` </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  employees ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="number">4</span>、查询常量值</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;John&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">5</span>、查询表达式</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">188</span><span class="operator">*</span><span class="number">98</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">6</span>、查询函数</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> VERSION();</span><br><span class="line"></span><br><span class="line">#<span class="number">7</span>、起别名</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1）便于理解</span></span><br><span class="line"><span class="comment">2）如果要查询的字段有重名的情况，使用别名可以区分开来</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">#<span class="keyword">Method</span> <span class="number">1</span><span class="comment">--使用AS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span> <span class="operator">%</span> <span class="number">98</span> <span class="keyword">AS</span> 结果;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">AS</span> 姓, first_name <span class="keyword">AS</span> 名 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">#<span class="keyword">Method</span> <span class="number">2</span><span class="comment">--省略AS,中间用一个空格</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name 姓, first_name 名 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">##案例： 查询salary，显示结果为<span class="keyword">out</span> put(别名的中间有空格)</span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> &quot;out put&quot; <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">#<span class="number">8</span>、去重<span class="comment">--DISTINCT</span></span><br><span class="line"></span><br><span class="line">##案例：查询员工表中涉及到的所有的部门编号</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">#<span class="number">9</span>、<span class="operator">+</span>号的作用</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">mysql中的+号：只能当作数学运算符</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">select 100+90; 两个操作数都为数值型，则做加法运算</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">select &#x27;123&#x27;+90; 其中一个是字符型，试图将字符型数据转换成数值型，</span></span><br><span class="line"><span class="comment">	如果转换成功，则继续做加法运算 （这里返回213）</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">select &#x27;john&#x27;+90; 如果无法转换，则将字符型数据当作0，再相加（这里返回90）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">select &#x27;12ab56c&#x27;+90; 只要前面能转换出一个数，就会把这个数与后面数字相加，</span></span><br><span class="line"><span class="comment">		这里字符型数据只能转换出12出来，所以结果是102</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">select null+90; 只要一方为null，结果一定也是null</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">##案例：查询员工名和姓连接成一个字段，并显示为 姓名</span><br><span class="line"><span class="comment">-- 下面这个示例是错误的，mysql语句中+号不能连接字段，只能当作数学运算符</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  last_name <span class="operator">+</span> first_name <span class="keyword">AS</span> 姓名 </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  employees ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面是正确的拼接方式，concat， concat自己不会添加空格，可自己指定</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(last_name,<span class="string">&#x27; &#x27;</span>, first_name) <span class="keyword">AS</span> 姓名 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"># <span class="number">10</span>、ifnull函数</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">IFNULL(expr1,expr2):</span></span><br><span class="line"><span class="comment">如果expr1是null,返回expr2,否则返回expr1自己的值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(commission_pct,<span class="number">0</span>) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>





<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表名</span><br><span class="line"><span class="keyword">where</span> 筛选条件 ;</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> 执行顺序</span><br><span class="line">  <span class="number">1.</span> `<span class="keyword">from</span>`：先判断有没有这个表，如果有先定位这个表</span><br><span class="line">  <span class="number">2.</span> `<span class="keyword">where</span>`：根据筛选条件（与表行一样长的<span class="literal">True</span><span class="operator">/</span><span class="literal">False</span>向量）选出合适的记录</span><br><span class="line">  <span class="number">3.</span> `<span class="keyword">select</span>`：最后从符合筛选条件的记录中，拿出需要的字段</span><br><span class="line"><span class="operator">-</span> 根据筛选条件的不同，可以进行分类</span><br><span class="line">  <span class="number">1.</span> 按条件表达式筛选</span><br><span class="line">     <span class="operator">-</span> 条件运算符：<span class="operator">&lt;</span>, <span class="operator">&gt;</span>, <span class="operator">&lt;&gt;</span><span class="operator">/</span><span class="operator">!=</span>, <span class="operator">&lt;=</span>, <span class="operator">&gt;=</span> </span><br><span class="line">  <span class="number">2.</span> 按逻辑表达式筛选</span><br><span class="line">     <span class="operator">-</span> 逻辑运算符：`<span class="operator">&amp;&amp;</span>, <span class="operator">||</span>, <span class="operator">!</span>`，但mysql自己标准的是`<span class="keyword">and</span>, <span class="keyword">or</span>, <span class="keyword">not</span>`</span><br><span class="line">  <span class="number">3.</span> 模糊查询</span><br><span class="line">     <span class="operator">-</span> `<span class="keyword">like</span>`, `<span class="keyword">between</span> <span class="keyword">and</span><span class="operator">/</span> <span class="keyword">not</span> <span class="keyword">between</span> <span class="keyword">and</span>`, `<span class="keyword">in</span>`, `<span class="keyword">is</span> <span class="keyword">null</span><span class="operator">/</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>`</span><br><span class="line">  </span><br><span class="line">  ```<span class="keyword">sql</span></span><br><span class="line">  #一、按条件表达式筛选</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">1</span>：查询工资<span class="operator">&gt;</span><span class="number">12000</span>的员工信息</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">12000</span>;</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">2</span>：查询部门编号不等于<span class="number">90</span>号的员工名和部门编号</span><br><span class="line">  <span class="keyword">SELECT</span> last_name, department_id</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> department_id <span class="operator">&lt;&gt;</span> <span class="number">90</span>;</span><br><span class="line">  </span><br><span class="line">  #二、按逻辑表达式筛选</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">1</span>：查询工资在<span class="number">10000</span>到<span class="number">20000</span>之间的员工名、工资以及资金</span><br><span class="line">  <span class="keyword">SELECT</span> last_name, salary, commission_pct</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">AND</span> salary <span class="operator">&lt;=</span> <span class="number">20000</span>;</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">2</span>：查询部门编号不是在<span class="number">90</span>到<span class="number">110</span>之间，或者工资高于<span class="number">15000</span>的员工信息</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> <span class="keyword">NOT</span>(department_id <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">AND</span> department_id <span class="operator">&lt;=</span> <span class="number">110</span>) <span class="keyword">OR</span> salary <span class="operator">&gt;</span> <span class="number">15000</span>;</span><br><span class="line">  </span><br><span class="line">  #三、模糊查询</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  like</span></span><br><span class="line"><span class="comment">      特点：</span></span><br><span class="line"><span class="comment">      1、一般和通配符搭配使用</span></span><br><span class="line"><span class="comment">       %：任意多个字符（包括0）</span></span><br><span class="line"><span class="comment">       _：任意单个字符</span></span><br><span class="line"><span class="comment">      2、也可以对数值型数据使用，相当于对数值转成字符后再模型匹配</span></span><br><span class="line"><span class="comment">  between and/ not between and</span></span><br><span class="line"><span class="comment">      使用between and 可以提高语句的简洁度</span></span><br><span class="line"><span class="comment">      包含临界值</span></span><br><span class="line"><span class="comment">      两个临界值不可以颠倒顺序，between aa and bb等价于 &gt;= aa and &lt;=bb</span></span><br><span class="line"><span class="comment">  in</span></span><br><span class="line"><span class="comment">      含义：用于判断某字段的值是否属于in列表中的某一项</span></span><br><span class="line"><span class="comment">      特点：</span></span><br><span class="line"><span class="comment">  	使用in相比于一系列or提高语句的简洁度</span></span><br><span class="line"><span class="comment">  	in列表中的值类型必须一致或兼容</span></span><br><span class="line"><span class="comment">  	不支持通配符</span></span><br><span class="line"><span class="comment">  is null/ is not null</span></span><br><span class="line"><span class="comment">      =, !=, &lt;&gt;不能用于判断null值</span></span><br><span class="line"><span class="comment">      is null/ is not null可以用于判断null</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  </span><br><span class="line">  #<span class="number">1</span>、<span class="keyword">like</span></span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">1</span>：查询员工名中包含字符a的员工信息</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> &quot;%a%&quot;;</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">2</span>：查询员工名中第三个字符为n，第五个字符为l的员工名和工资</span><br><span class="line">  <span class="keyword">SELECT</span> last_name, salary</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;__n_l%&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">3</span>：查询员工名中第二个字符为_的员工名（转义字符）</span><br><span class="line">  # 方法一：默认可以用\转义</span><br><span class="line">  <span class="keyword">SELECT</span> last_name</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_\_%&#x27;</span>; </span><br><span class="line">  </span><br><span class="line">  # 方法二：自定义转义字符</span><br><span class="line">  <span class="keyword">SELECT</span> last_name</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_$_%&#x27;</span> <span class="keyword">ESCAPE</span> <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">4</span>：查询部门编号是由<span class="number">1</span>开头的三位数的部门编号 （匹配数值型数据）</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> department_id <span class="keyword">LIKE</span> <span class="string">&#x27;1__&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  # <span class="number">2</span>、<span class="keyword">between</span> <span class="keyword">and</span>（左闭右闭）</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">1</span>：查询员工编号在<span class="number">100</span>到<span class="number">120</span>之间的所有员工信息</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> employee_id <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">120</span>;</span><br><span class="line">  </span><br><span class="line">  # <span class="number">3</span>、<span class="keyword">in</span></span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">1</span>：查询员工的工种编号是 IP_PROG,AD_VP, AD_PRES中的一个的员工名和工种编号</span><br><span class="line">  <span class="keyword">SELECT</span> last_name, job_id</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> job_id <span class="keyword">IN</span> (<span class="string">&#x27;IP_PROG&#x27;</span>,<span class="string">&#x27;AD_VP&#x27;</span>,<span class="string">&#x27;AD_PRES&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  # <span class="number">4</span>、<span class="keyword">is</span> <span class="keyword">null</span><span class="operator">/</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">1</span>：查询没有资金的员工名和资金率</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">SELECT</span> last_name, commission_pct</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">2</span>：查询有资金的员工名和资金率</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">SELECT</span> last_name, commission_pct</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  ##</span><br><span class="line">  ##安全等于<span class="operator">&lt;=&gt;</span></span><br><span class="line">  ##</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  可以用于判断null值或正常=可以判断的类型</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  #案例<span class="number">1</span>：查询没有资金的员工名和资金率</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">SELECT</span> last_name, commission_pct</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> commission_pct <span class="operator">&lt;=&gt;</span> <span class="keyword">NULL</span>;</span><br><span class="line">  </span><br><span class="line">  #案例<span class="number">2</span>：查询工资为<span class="number">12000</span>的员工信息</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> salary <span class="operator">&lt;=&gt;</span> <span class="number">12000</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h2><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表名</span><br><span class="line">[<span class="keyword">where</span> 筛选条件]</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序列表[<span class="keyword">asc</span> <span class="operator">|</span> <span class="keyword">desc</span>]</span><br><span class="line"></span><br><span class="line">#案例：查询员工信息，要求工资从高到低排序</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行顺序：</p>
<ol>
<li><code>from</code></li>
<li><code>where</code></li>
<li><code>select</code></li>
<li><code>order by</code>：因为在select后面，故在select中的别名可以用来真的排序</li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li><code>asc</code>代表升序，默认选项，<code>desc</code>降序</li>
<li><code>order by</code>子句中可以支持单个字段、多个字段、表达式、函数、别名</li>
<li><code>order by</code>子句一般是放在查询语句的最后面，<code>limit</code>子句除外</li>
</ol>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#案例<span class="number">1</span>：查询员工信息，要求工资从高到低排序</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">2</span>【添加筛选条件】：查询部门编号<span class="operator">&gt;=</span><span class="number">90</span>的员工信息，按入职时间的先后进行排序</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">&gt;=</span> <span class="number">90</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hiredate <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">3</span>【按表达式排序】：按年薪的高低显示员工的信息和年薪</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>, salary<span class="operator">*</span><span class="number">12</span><span class="operator">*</span>(<span class="number">1</span><span class="operator">+</span>IFNULL(commission_pct,<span class="number">0</span>)) 年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary<span class="operator">*</span><span class="number">12</span><span class="operator">*</span>(<span class="number">1</span><span class="operator">+</span>IFNULL(commission_pct,<span class="number">0</span>)) <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">4</span>【按别名排序】：按年薪的高低显示员工的信息和年薪</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>, salary<span class="operator">*</span><span class="number">12</span><span class="operator">*</span>(<span class="number">1</span><span class="operator">+</span>IFNULL(commission_pct,<span class="number">0</span>)) 年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年薪 <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">5</span>【按函数排序】：按姓名的长度降序显示员工的姓名的工资</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, LENGTH(last_name) 姓名长度</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> LENGTH(last_name) <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line">#案例<span class="number">6</span>【多个字段组合排序】：查询员工信息，要求先按工资排序，再按员工编号排序</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>, employee_id <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h2 id="常见函数"><a href="#常见函数" class="headerlink" title="常见函数"></a>常见函数</h2><ul>
<li>功能<ul>
<li>概念：将一组逻辑、操作语句封装，对外暴露方法名</li>
<li>好处：隐藏实现细节，提高代码的重用性</li>
<li>调用：<code>select 函数名() [from 表名]</code></li>
<li>特点：<ol>
<li>函数名</li>
<li>函数功能</li>
</ol>
</li>
<li>分类<ol>
<li>单行函数：<code>concat()</code>, <code>length()</code>, <code>ifnull()</code><ul>
<li>字符函数</li>
<li>数学函数</li>
<li>日期函数</li>
<li>其他函数</li>
<li>流程控制函数</li>
</ul>
</li>
<li>分组函数<ul>
<li>做统计使用，又称为统计函数、聚合函数、组函数</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h2><h3 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#一、字符函数</span><br><span class="line"></span><br><span class="line">#<span class="number">1</span>、length 获取参数值的字节（不是字符）个数，英文<span class="number">1</span>个，中文在utf8下<span class="number">3</span>个</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;John&#x27;</span>); <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;张&#x27;</span>); <span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;张美丽abc&#x27;</span>); <span class="comment">-- 12</span></span><br><span class="line"></span><br><span class="line">#<span class="number">2</span>、concat 拼接字符串</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(last_name, <span class="string">&#x27;_&#x27;</span>, first_name) 姓名</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">#<span class="number">3</span>、upper , lower 转大小写</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;john&#x27;</span>); <span class="comment">-- JOHN</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;JOHN&#x27;</span>); <span class="comment">-- john</span></span><br><span class="line"></span><br><span class="line">#示例：将姓变大写，名变小写，然后拼接</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="built_in">UPPER</span>(last_name),<span class="built_in">LOWER</span>(first_name)) 姓名</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">#<span class="number">4</span>、substr(substring)</span><br><span class="line"><span class="comment">-- ！！sql语言中索引从1开始</span></span><br><span class="line"><span class="comment">-- substr(str, start),从start开始截到最后</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;李莫愁爱上了陆展元&#x27;</span>, <span class="number">6</span>) out_put; <span class="comment">-- 了陆展元</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;李莫愁爱上了陆展元&#x27;</span>, <span class="number">7</span>) out_put; <span class="comment">-- 陆展元</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- substr(str, start， len),从start开始截len个字符长度（是字符）</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;李莫愁爱上了陆展元&#x27;</span>, <span class="number">1</span>,<span class="number">3</span>) out_put; <span class="comment">-- 李莫愁</span></span><br><span class="line"></span><br><span class="line">#案例：姓名中首字符大写，其它字符小写然后用_拼接，显示出来</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="built_in">UPPER</span>(SUBSTR(last_name,<span class="number">1</span>,<span class="number">1</span>)),<span class="string">&#x27;_&#x27;</span>,SUBSTR(last_name,<span class="number">2</span>)) out_put</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">#<span class="number">5</span>、instr 返回子字符串在原字符串的第一次起始索引，如果不存在返回<span class="number">0</span></span><br><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;杨不悔爱上了殷六侠&#x27;</span>,<span class="string">&#x27;殷六侠&#x27;</span>) <span class="keyword">AS</span> out_put;<span class="comment">-- 7</span></span><br><span class="line"></span><br><span class="line">#<span class="number">6</span>、trim去除前后空格或指定的符号</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;  张翠山   &#x27;</span>) <span class="keyword">AS</span> output, LENGTH(<span class="built_in">TRIM</span>(<span class="string">&#x27;  张翠山   &#x27;</span>)) <span class="keyword">AS</span> len;</span><br><span class="line"></span><br><span class="line">#下面的要注意区分，trim只会整数倍的去除<span class="keyword">from</span>前的指定字符串</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;a&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;aaaa张aa翠aaa山aaaaa&#x27;</span>) <span class="keyword">AS</span> out_put; <span class="comment">-- 张aa翠aaa山</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;aa&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;aaaa张aa翠aaa山aaaaa&#x27;</span>) <span class="keyword">AS</span> out_put; <span class="comment">-- 张aa翠aaa山a</span></span><br><span class="line"></span><br><span class="line">#<span class="number">7</span>、lpad <span class="operator">-</span>用指定的字符实现左填充到指定长度</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;殷素素&#x27;</span>,<span class="number">10</span>,<span class="string">&#x27;*&#x27;</span>) <span class="keyword">AS</span> out_put; <span class="comment">-- *******殷素素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;殷素素&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;*&#x27;</span>) <span class="keyword">AS</span> out_put; <span class="comment">-- 殷素（填充字符长度小于原字符串长度）</span></span><br><span class="line"></span><br><span class="line">#<span class="number">8</span>、rpad <span class="operator">-</span>用指定的字符实现左填充到指定长度</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">&#x27;殷素素&#x27;</span>,<span class="number">10</span>,<span class="string">&#x27;ab&#x27;</span>) <span class="keyword">AS</span> out_put; <span class="comment">-- 殷素素abababa</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">&#x27;殷素素&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;ab&#x27;</span>) <span class="keyword">AS</span> out_put; <span class="comment">-- 殷素(也是从左边开始截断）</span></span><br><span class="line"></span><br><span class="line">#<span class="number">9</span>、replace 替换</span><br><span class="line"><span class="keyword">SELECT</span> REPLACE(<span class="string">&#x27;张无忌周芷若爱上了周芷若&#x27;</span>,<span class="string">&#x27;周芷若&#x27;</span>,<span class="string">&#x27;赵敏&#x27;</span>) <span class="keyword">AS</span> output; <span class="comment">-- 张无忌赵敏爱上了赵敏</span></span><br></pre></td></tr></table></figure>

<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#二、数学函数</span><br><span class="line"></span><br><span class="line">##<span class="number">1</span>、round 四舍五入</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1.65</span>); <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1.45</span>); <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">-1.65</span>); <span class="comment">-- -2</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">-1.45</span>); <span class="comment">-- -1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1.567</span>,<span class="number">2</span>); <span class="comment">-- 1.57</span></span><br><span class="line"></span><br><span class="line">##<span class="number">2</span>、ceil 向上取整</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">1.0022</span>); <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">-1.999</span>); <span class="comment">-- -1</span></span><br><span class="line"></span><br><span class="line">##<span class="number">3</span>、floor 向下取整</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">1.0022</span>); <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">-1.999</span>); <span class="comment">-- -2</span></span><br><span class="line"></span><br><span class="line">##<span class="number">4</span>、<span class="keyword">truncate</span> 截断</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1.567</span>,<span class="number">2</span>); <span class="comment">-- 1.56</span></span><br><span class="line"></span><br><span class="line">##<span class="number">5</span>、mod取余</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">mod(a,b) = a - (a//b)*b</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">mod(-10,-3) = (-10) - (-10//(-3))*(-3) = -1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">-10</span>,<span class="number">-3</span>); <span class="comment">-- -1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>,<span class="number">3</span>); <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">10</span> <span class="operator">%</span> <span class="number">3</span>;  <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>,<span class="number">-3</span>); <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">-10</span>,<span class="number">3</span>); <span class="comment">-- -1</span></span><br></pre></td></tr></table></figure>

<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><table>
<thead>
<tr>
<th>格式符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><code>%Y</code></td>
<td>四位的年份</td>
</tr>
<tr>
<td><code>%y</code></td>
<td>两位的年份</td>
</tr>
<tr>
<td><code>%m</code></td>
<td>月份（01, 02, 03,…..,10,11,12）</td>
</tr>
<tr>
<td><code>%c</code></td>
<td>月份(1, 2, 3,…., 10, 11, 12)</td>
</tr>
<tr>
<td><code>%d</code></td>
<td>日(01, 02, …)</td>
</tr>
<tr>
<td><code>%H</code></td>
<td>小时（24小时制）</td>
</tr>
<tr>
<td><code>%h</code></td>
<td>小时（12小时制）</td>
</tr>
<tr>
<td><code>%i</code></td>
<td>分钟(00,01,….,59)</td>
</tr>
<tr>
<td><code>%s</code></td>
<td>秒（00,01,…, 59)</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#三、日期函数</span><br><span class="line"></span><br><span class="line">##<span class="number">1</span>、now 返回当前系统日期和时间</span><br><span class="line"><span class="keyword">SELECT</span> NOW(); <span class="comment">-- 2023-07-05 15:53:05</span></span><br><span class="line"></span><br><span class="line">##<span class="number">2</span>、curdate 仅返回当前系统日期</span><br><span class="line"><span class="keyword">SELECT</span> CURDATE(); <span class="comment">-- 2023-07-05</span></span><br><span class="line"></span><br><span class="line">##<span class="number">3</span>、curtime 仅返回当前系统时间</span><br><span class="line"><span class="keyword">SELECT</span> CURTIME(); <span class="comment">-- 15:55:12</span></span><br><span class="line"></span><br><span class="line">##<span class="number">4</span>、获取指定的部分，年，月，日，小时，分钟，秒</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW()); <span class="comment">-- 2023</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="string">&#x27;20100102&#x27;</span>); <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> MONTHNAME(<span class="string">&#x27;2023-07-05&#x27;</span>); <span class="comment">-- July</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(hiredate) 年</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">##<span class="number">5</span>、str_to_date 字符串转日期</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;2023|06|06&#x27;</span>,<span class="string">&#x27;%Y|%m|%d&#x27;</span>); <span class="comment">-- 2023-06-06</span></span><br><span class="line"></span><br><span class="line">#案例：查询入职日期为<span class="number">1992</span><span class="number">-4</span><span class="number">-3</span>的员工信息</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hiredate <span class="operator">=</span> <span class="string">&#x27;1992-04-03&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#案例：假设客户端输入<span class="string">&#x27;4-3 1992&#x27;</span>，查询这个入职日期的员工信息</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hiredate <span class="operator">=</span> STR_TO_DATE(<span class="string">&#x27;4-3 1992&#x27;</span>,<span class="string">&#x27;%c-%d %Y&#x27;</span>);</span><br><span class="line"></span><br><span class="line">##<span class="number">6</span>、date_format 将日期转为字符</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(<span class="string">&#x27;2023-06-06&#x27;</span>,<span class="string">&#x27;%Y年%m月%d日&#x27;</span>);<span class="comment">-- 2023年06月06日</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(),<span class="string">&#x27;%Y年%m月%d日&#x27;</span>);<span class="comment">-- 2023年07月05日</span></span><br><span class="line"></span><br><span class="line">#案例：查询有奖金的员工名和入职日期(xx月<span class="operator">/</span>xx日 xxxx年）</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, DATE_FORMAT(hiredate, <span class="string">&#x27;%m月/%d日 %Y年&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##<span class="number">7</span>、datediff </span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2023-07-01&#x27;</span>,<span class="string">&#x27;2023-06-25&#x27;</span>); # <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(NOW(), <span class="string">&#x27;2000-01-01&#x27;</span>); # <span class="number">8586</span></span><br><span class="line"></span><br><span class="line">#案例<span class="number">1</span>：查询最晚的入职时间和最早的入职时间差多少天</span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="built_in">MAX</span>(hiredate), <span class="built_in">MIN</span>(hiredate)) <span class="keyword">FROM</span> employees; # <span class="number">8753</span></span><br><span class="line"></span><br><span class="line">#案例<span class="number">2</span>：查询最 早 的入职时间和 最 晚 的入职时间差多少天</span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="built_in">MIN</span>(hiredate), <span class="built_in">MAX</span>(hiredate)) <span class="keyword">FROM</span> employees; # <span class="number">-8753</span></span><br></pre></td></tr></table></figure>

<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#四、其他函数</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> VERSION();</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();</span><br></pre></td></tr></table></figure>

<h3 id="流程控制函数"><a href="#流程控制函数" class="headerlink" title="流程控制函数"></a>流程控制函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">#五、流程控制函数</span><br><span class="line"></span><br><span class="line">##<span class="number">1</span>、if函数：if<span class="operator">-</span><span class="keyword">else</span>效果</span><br><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">10</span> <span class="operator">&gt;</span> <span class="number">5</span>, <span class="string">&#x27;大&#x27;</span>, <span class="string">&#x27;小&#x27;</span>); <span class="comment">-- 大</span></span><br><span class="line"></span><br><span class="line">#案例：判断员工是否有奖金</span><br><span class="line"><span class="keyword">SELECT</span> last_name, commission_pct, IF(commission_pct <span class="keyword">IS</span> <span class="keyword">NULL</span>, <span class="string">&#x27;没资金&#x27;</span>,<span class="string">&#x27;有资金&#x27;</span>) <span class="string">&#x27;备注&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">##<span class="number">2</span>、<span class="keyword">case</span>函数</span><br><span class="line">#使用一：switch <span class="keyword">case</span>的效果</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">C/JAVA中</span></span><br><span class="line"><span class="comment">switch(变量或表达式)&#123;</span></span><br><span class="line"><span class="comment">	case 常量1: 语句1; break;</span></span><br><span class="line"><span class="comment">	...</span></span><br><span class="line"><span class="comment">	default: 语句n;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">mysql中</span></span><br><span class="line"><span class="comment">case 要判断的字段或表达式</span></span><br><span class="line"><span class="comment">when 常量1 then 要显示的值1[或语句1;(只有是语句的时候才需要加分号）]</span></span><br><span class="line"><span class="comment">when 常量2 then 要显示的值2[或语句2;]</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">else 要显示的值n或[语句n;]</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">案例：查询员工的工资，要求</span></span><br><span class="line"><span class="comment">	部门号=30，显示的工资为1.1倍</span></span><br><span class="line"><span class="comment">	部门号=40，显示的工资为1.2倍</span></span><br><span class="line"><span class="comment">	部门号=50，显示的工资为1.3倍</span></span><br><span class="line"><span class="comment">	其他部门，显示原工资</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> salary 旧工资, department_id, </span><br><span class="line">	<span class="keyword">CASE</span> department_id</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">30</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.1</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">40</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.2</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">50</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.3</span></span><br><span class="line">	<span class="keyword">ELSE</span> salary</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> 新工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">#使用二：类似多重if</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">C/JAVA中</span></span><br><span class="line"><span class="comment">if(条件)&#123;</span></span><br><span class="line"><span class="comment">	语句1;</span></span><br><span class="line"><span class="comment">&#125; else if(条件)&#123;</span></span><br><span class="line"><span class="comment">	语句2;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">else&#123;</span></span><br><span class="line"><span class="comment">	语句n;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">mysql中</span></span><br><span class="line"><span class="comment">case </span></span><br><span class="line"><span class="comment">when 条件 then 值[或者语句;]</span></span><br><span class="line"><span class="comment">when 条件 then 值[或者语句;]</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">else 值[或语句n;]</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*案例：查询员工的新工资情况</span></span><br><span class="line"><span class="comment">	如果工资&gt;20000，显示A级别</span></span><br><span class="line"><span class="comment">	如果工资&gt;15000, 显示B级别</span></span><br><span class="line"><span class="comment">	如果工资&gt;10000, 显示C级别</span></span><br><span class="line"><span class="comment">	否则，显示D级别</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> salary, </span><br><span class="line">	<span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> salary <span class="operator">&gt;</span><span class="number">20000</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> salary <span class="operator">&gt;</span> <span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> salary <span class="operator">&gt;</span> <span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> 工资级别</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><ul>
<li><p>功能</p>
<ul>
<li>用作统计使用，又称为聚合函数或统计函数或组函数</li>
</ul>
</li>
<li><p>分类</p>
<ul>
<li>sum：求和</li>
<li>avg：平均值</li>
<li>max：求最大值</li>
<li>min：求最小值</li>
<li>count：计算个数</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>sum, avg ：一般用于处理数值型</li>
<li>min, max, count：可以处理任意数据类型</li>
<li>都忽略null值</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#分组函数</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">分类：</span></span><br><span class="line"><span class="comment">sum</span></span><br><span class="line"><span class="comment">avg</span></span><br><span class="line"><span class="comment">max</span></span><br><span class="line"><span class="comment">min</span></span><br><span class="line"><span class="comment">count</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">##<span class="number">1</span>、简单的使用</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) 总和, <span class="built_in">AVG</span>(salary) 平均, <span class="built_in">MIN</span>(salary) 最低 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line">##<span class="number">2</span>、参数支持哪些类型</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">sum, avg：只支持数值型</span></span><br><span class="line"><span class="comment">mim, max, count：可以支持任何类型，数值、字符、时间</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">##<span class="number">3</span>、是否忽略<span class="keyword">null</span>值</span><br><span class="line"># 都忽略<span class="keyword">null</span>值</span><br><span class="line"></span><br><span class="line">##<span class="number">4</span>、和<span class="keyword">distinct</span>搭配</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(<span class="keyword">DISTINCT</span> salary) <span class="keyword">FROM</span> employees; <span class="comment">-- 对去重之后的salary求和</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> salary) <span class="keyword">FROM</span> employees;<span class="comment">-- 57, 有57个级别的工资水平</span></span><br><span class="line"></span><br><span class="line">##<span class="number">5</span>、count函数的详细介绍</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees; <span class="comment">-- 统计表的总行数，主键一定不存在null</span></span><br><span class="line">				<span class="comment">-- 只要有一行不为空，就会count上</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> employees; <span class="comment">-- 也计算了总行数，相当于创建了一列1再计数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">效率：</span></span><br><span class="line"><span class="comment">mysam(5.5版本前）存储引擎下，count(*)效率高</span></span><br><span class="line"><span class="comment">innodb（5.5版本后）存储引擎下，count(*)和count(1)效率差不多，比count(字段）要高</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">##<span class="number">6</span>、和分组函数一同查询的字段有限制</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">和分组函数一同查询的字段要求是group by后的字段</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面的语句无意义，报错</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary), employee_id <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><ul>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 分组函数， 列（要求出现在<span class="keyword">group</span> <span class="keyword">by</span> 的后面）</span><br><span class="line"><span class="keyword">from</span> 表</span><br><span class="line">[<span class="keyword">where</span> 筛选条件]</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组列表</span><br><span class="line">[<span class="keyword">order</span> <span class="keyword">by</span> 子句]</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意</p>
<ul>
<li>查询列表必须特殊，要求是分组函数和group by后出现的字段</li>
</ul>
</li>
<li><p>特点</p>
<ol>
<li>分组查询中的筛选条件分为两类<ul>
<li>分组前筛选：对原始表进行筛选——放在group by子句前——where子句</li>
<li>分组后筛选：对分组后的结果集进行筛选——放在group by子句后——having子句</li>
<li>分组函数做条件肯定在having子句中</li>
<li>能用分组前筛选的，尽量用where子句</li>
</ul>
</li>
<li>group by 子句支持单个字段分组，多个字段分组（多个字段之间用逗号隔开，没有顺序要求），表达式或者函数（用的较少）</li>
<li>也可以添加排序，放在分组查询最后</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">#进阶5：分组查询</span><br><span class="line"></span><br><span class="line">#引入：查询每个部门的平均工资</span><br><span class="line"></span><br><span class="line">SELECT department_id, AVG(salary) AS department_avg_salary </span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id IS NOT NULL</span><br><span class="line">GROUP BY department_id</span><br><span class="line">ORDER BY department_avg_salary DESC;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">## 简单的分组查询</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：查询每个工种的最高工资</span><br><span class="line"></span><br><span class="line">SELECT job_id,MAX(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY job_id;</span><br><span class="line"></span><br><span class="line">#案例2：查询每个位置上的部门个数</span><br><span class="line"></span><br><span class="line">SELECT COUNT(*), location_id</span><br><span class="line">FROM departments</span><br><span class="line">GROUP BY location_id;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">## 添加筛选条件</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：查询邮箱中包含a字符的，每个部门的平均工资</span><br><span class="line"></span><br><span class="line">SELECT AVG(salary), department_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE email LIKE &#x27;%a%&#x27;</span><br><span class="line">GROUP BY department_id;</span><br><span class="line"></span><br><span class="line">#案例2：查询有资金的每个领导手下员工的最高工资</span><br><span class="line"></span><br><span class="line">SELECT MAX(salary), manager_id</span><br><span class="line">FROM employees</span><br><span class="line">WHERE commission_pct IS NOT NULL</span><br><span class="line">GROUP BY manager_id;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">## 添加复杂的筛选条件(分组后的筛选）</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">-- having可以调用select中的参量，where只能调用from表中的字段 </span><br><span class="line"></span><br><span class="line">#案例1：查询哪个部门的员工个数大于2</span><br><span class="line"></span><br><span class="line">SELECT department_id, COUNT(*)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING COUNT(*) &gt; 2;</span><br><span class="line"></span><br><span class="line">#案例2：查询每个工种有资金的员工的最高工资&gt;12000的工种编号和最高工资</span><br><span class="line"></span><br><span class="line">SELECT job_id, MAX(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE commission_pct IS NOT NULL</span><br><span class="line">GROUP BY job_id</span><br><span class="line">HAVING MAX(salary) &gt; 12000;</span><br><span class="line"></span><br><span class="line">#案例3：查询领导编号&gt;102的每个领导手下的员工最低工资&gt;5000的领导编号和最低工资</span><br><span class="line"></span><br><span class="line">SELECT manager_id, MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">WHERE manager_id&gt; 102</span><br><span class="line">GROUP BY manager_id</span><br><span class="line">HAVING MIN(salary) &gt; 5000;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">## 按表达式或函数分组</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例：按员工姓名的长度分组，查询每一组的员工个数，筛选员工个数&gt;5的有哪些</span><br><span class="line"></span><br><span class="line">SELECT COUNT(*) numbers, LENGTH(last_name) LEN_Name</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY LENGTH(last_name)</span><br><span class="line">HAVING numbers &gt; 5;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">## 按多外字段</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：查询每个部门每个工种的员工的平均工资</span><br><span class="line"></span><br><span class="line">SELECT department_id, job_id, AVG(salary) mean_salary</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id, job_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">## 添加排序</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：查询每个(非空）部门每个工种的员工的平均工资，并对平均工资大于10000的结果按平均工资逆序输出</span><br><span class="line"></span><br><span class="line">SELECT department_id, job_id, AVG(salary) mean_salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id IS NOT NULL</span><br><span class="line">GROUP BY department_id, job_id</span><br><span class="line">HAVING mean_salary &gt; 10000</span><br><span class="line">ORDER BY mean_salary DESC;</span><br></pre></td></tr></table></figure>

<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><ul>
<li><p>含义</p>
<ul>
<li>又称多表查询，当查询的字段来自多个表时，需要涉及连接查询</li>
</ul>
</li>
<li><p>笛卡尔乘积现象：表1有m行，表2有n行，结果有 m*n 行</p>
<ul>
<li>产生原因：没有有效的连接条件</li>
<li>解决方法：添加有效的连接条件——在<code>where</code>子名中限定，注意不同字段相等要用属性方法标明来自哪个表</li>
</ul>
</li>
<li><p>分类</p>
<ul>
<li>按年代分类<ul>
<li>SQL92标准：仅支持内连接</li>
<li>SQL99标准【推荐】：支持内边接+外连接（左外和右外)+交叉连接</li>
</ul>
</li>
<li>按功能分类<ul>
<li>内连接<ul>
<li>等值连接</li>
<li>非等值连接</li>
<li>自连接</li>
</ul>
</li>
<li>外连接<ul>
<li>左外连接</li>
<li>右外连接</li>
<li>全外连接</li>
</ul>
</li>
<li>交叉连接</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>SQL92</p>
<h4 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line">## 一、SQL92标准</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">#####</span><br><span class="line"># （一）、等值连接</span><br><span class="line">#1、多表等值连接的结果为多表的交集部分</span><br><span class="line">#2、n表连接，至少需要n-1个连接条件</span><br><span class="line">#3、多表的顺序没有要求</span><br><span class="line">#4、一般需要为表起别名</span><br><span class="line">#5、可以搭配前面介绍的所有子句使用</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">#案例1：查询女神名和对应的男神名</span><br><span class="line"></span><br><span class="line">SELECT `name`, boyName</span><br><span class="line">FROM beauty, boys</span><br><span class="line">WHERE beauty.`boyfriend_id` = boys.`id`;</span><br><span class="line"></span><br><span class="line">#案例2：查询员工名和对应的部门名</span><br><span class="line"></span><br><span class="line">SELECT last_name, department_name</span><br><span class="line">FROM employees, departments</span><br><span class="line">WHERE employees.`department_id` = departments.`department_id`;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># 1、为表起别名</span><br><span class="line">###</span><br><span class="line">/*</span><br><span class="line">- 提高语句的简洁度</span><br><span class="line">- 区分多处重名的字段</span><br><span class="line">- from子句对表起别名后，则查询的字段不能再用原来的表名来限定</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#案例：查询员工名，工种号，工种名</span><br><span class="line"></span><br><span class="line">SELECT last_name, e.job_id, job_title -- 有歧义的字段要标明来自哪个表</span><br><span class="line">FROM employees AS e, jobs AS j</span><br><span class="line">WHERE e.`job_id` = j.`job_id`;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># 2、两个表的顺序可以调换</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：查询员工名，工种号，工种名</span><br><span class="line"></span><br><span class="line">SELECT last_name, j.job_id, job_title -- 有歧义的字段要标明来自哪个表</span><br><span class="line">FROM jobs AS j, employees AS e</span><br><span class="line">WHERE j.`job_id` = e.`job_id`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># 3、添加筛选</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：查询有资金的员工名、部门名</span><br><span class="line"></span><br><span class="line">SELECT last_name, department_name, commission_pct</span><br><span class="line">FROM employees AS e, departments AS d</span><br><span class="line">WHERE e.`department_id` = d.`department_id` </span><br><span class="line">AND `commission_pct` IS NOT NULL;</span><br><span class="line">	</span><br><span class="line">#案例2：查询城市名中第二个字符为o的部门名和城市名</span><br><span class="line"></span><br><span class="line">SELECT department_name, city</span><br><span class="line">FROM departments AS d, locations AS l</span><br><span class="line">WHERE d.`location_id` = l.location_id</span><br><span class="line">AND city LIKE &#x27;_o%&#x27;;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># 4、添加分组</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：查询每个城市的部门个数</span><br><span class="line"></span><br><span class="line">SELECT COUNT(*), city</span><br><span class="line">FROM departments AS d , locations AS l</span><br><span class="line">WHERE d.`location_id` = l.`location_id`</span><br><span class="line">GROUP BY city;</span><br><span class="line"></span><br><span class="line">#案例2：查询有资金的每个部门的部门名和部门的领导编号和该部门的最低工资</span><br><span class="line"></span><br><span class="line">SELECT d.department_name, d.manager_id,MIN(salary)</span><br><span class="line">FROM employees AS e, departments AS d</span><br><span class="line">WHERE e.`department_id` = d.`department_id`</span><br><span class="line">AND commission_pct IS NOT NULL</span><br><span class="line">GROUP BY d.`manager_id`, d.`department_id`;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># 5、添加排序</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：添加每个工种的工种名和员工的个数，并且按员工个数降序</span><br><span class="line"></span><br><span class="line">SELECT job_title, COUNT(*) AS nums</span><br><span class="line">FROM employees AS e, jobs AS j</span><br><span class="line">WHERE e.`job_id` = j.`job_id`</span><br><span class="line">GROUP BY job_title</span><br><span class="line">ORDER BY nums DESC;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### </span><br><span class="line"># 6、三表连接</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：查询员工名、部门名和所在的城市</span><br><span class="line"></span><br><span class="line">SELECT last_name, department_name, city</span><br><span class="line">FROM employees AS e, departments AS d, locations AS l</span><br><span class="line">WHERE e.`department_id` = d.`department_id` </span><br><span class="line">AND d.`location_id` = l.`location_id`;</span><br></pre></td></tr></table></figure>

<h4 id="非等值连接"><a href="#非等值连接" class="headerlink" title="非等值连接"></a>非等值连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line">#（二）、非等徝连接</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">#案例1：查询员工的工资和工资级别</span><br><span class="line"></span><br><span class="line">SELECT salary, grade_level</span><br><span class="line">FROM employees AS e, job_grades AS g</span><br><span class="line">WHERE e.`salary` BETWEEN g.`lowest_sal` AND g.`highest_sal`;</span><br></pre></td></tr></table></figure>

<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line"># （三）、自连接</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">#案例：查询员工名和上级的名称</span><br><span class="line"></span><br><span class="line">SELECT e.employee_id, e.last_name, e.`manager_id`, m.last_name</span><br><span class="line">FROM employees AS e, employees AS m</span><br><span class="line">WHERE e.`manager_id` = m.`employee_id`;</span><br></pre></td></tr></table></figure>

<h3 id="SQL99"><a href="#SQL99" class="headerlink" title="SQL99"></a>SQL99</h3><ul>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select 查询列表</span><br><span class="line">from 表1 别名【连接类型】</span><br><span class="line">	join 表2 别名 </span><br><span class="line">	on 连接条件</span><br><span class="line">【where 筛选条件】</span><br><span class="line">【group by  分组】</span><br><span class="line">【having 筛选条件】</span><br><span class="line">【order by 排序列表】</span><br></pre></td></tr></table></figure>
</li>
<li><p>分类</p>
<ul>
<li>内连接：<code>inner</code></li>
<li>外连接<ul>
<li>左外<code>left [outer]</code></li>
<li>右外<code>right [outer]</code></li>
<li>全外<code>full [outer]</code></li>
</ul>
</li>
<li>交叉连接<code>cross</code></li>
</ul>
</li>
</ul>
<h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><h5 id="等值连接-1"><a href="#等值连接-1" class="headerlink" title="等值连接"></a>等值连接</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line">#（一）、内连接</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line">slelect 查询列表</span><br><span class="line">from 表1 别名</span><br><span class="line">inner join 表2 别名</span><br><span class="line">on 连接条件</span><br><span class="line"></span><br><span class="line">分类：</span><br><span class="line">等值连接</span><br><span class="line">非等值连接</span><br><span class="line">自连接</span><br><span class="line"></span><br><span class="line">特点：</span><br><span class="line">1、可以添加排序、分组、筛选</span><br><span class="line">2、inner可以省略</span><br><span class="line">3、筛选条件放在where后面，连接条件放在on后面，提高分离性，便于阅读</span><br><span class="line">4、inner join连接和SQL92语法中的等值连接效果一样，都是查询多表的交集</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">#1、等值连接</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：查询员工名、部门名</span><br><span class="line"></span><br><span class="line">SELECT last_name, department_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN departments AS d</span><br><span class="line">ON e.`department_id` = d.`department_id`;</span><br><span class="line"></span><br><span class="line">#案例2【添加筛选】：查询名字中包含e的员工名和工种名</span><br><span class="line"></span><br><span class="line">SELECT last_name, job_title</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN jobs AS j</span><br><span class="line">ON e.`job_id` = j.`job_id`</span><br><span class="line">WHERE last_name LIKE &#x27;%e%&#x27;;</span><br><span class="line"></span><br><span class="line">#案例3【添加分组、筛选】：查询部门个数&gt;3的城市名和部门个数 </span><br><span class="line"></span><br><span class="line">SELECT city, COUNT(*) dep_nums</span><br><span class="line">FROM departments AS d</span><br><span class="line">INNER JOIN locations AS l</span><br><span class="line">ON d.`location_id` = l.`location_id`</span><br><span class="line">GROUP BY city</span><br><span class="line">HAVING COUNT(*) &gt; 3;</span><br><span class="line"></span><br><span class="line">#案例4【排序】：查询员工个数&gt;3的部门名和员工个数，并按员工个数降序输出 </span><br><span class="line"></span><br><span class="line">SELECT department_name, COUNT(*) employ_nums</span><br><span class="line">FROM departments AS d</span><br><span class="line">INNER JOIN employees AS e</span><br><span class="line">ON e.`department_id` = d.`department_id`</span><br><span class="line">GROUP BY department_name</span><br><span class="line">HAVING COUNT(*) &gt; 3</span><br><span class="line">ORDER BY COUNT(*) DESC;</span><br><span class="line"></span><br><span class="line">#案例5【三表连接】：查询员工名、部门名，工种名，并按部门名降序</span><br><span class="line"></span><br><span class="line">SELECT last_name, department_name, job_title</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN departments AS d ON e.`department_id` = d.`department_id`</span><br><span class="line">INNER JOIN jobs AS j ON e.`job_id` = j.`job_id`</span><br><span class="line">ORDER BY department_name DESC;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="非等值连接-1"><a href="#非等值连接-1" class="headerlink" title="非等值连接"></a>非等值连接</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#2、非等值连接</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：查询员工的工资级别</span><br><span class="line"></span><br><span class="line">SELECT salary, grade_level</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN job_grades AS g</span><br><span class="line">ON e.`salary` BETWEEN g.`lowest_sal` AND g.`highest_sal`;</span><br><span class="line"></span><br><span class="line">#案例：查询不同工资级别的员工个数，并对员工个数大于20的工资级别和员工个数降序输出 </span><br><span class="line"></span><br><span class="line">SELECT grade_level, COUNT(*) employ_nums</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN job_grades AS g</span><br><span class="line">ON e.`salary` BETWEEN g.`lowest_sal` AND g.`highest_sal`</span><br><span class="line">GROUP BY grade_level</span><br><span class="line">HAVING COUNT(*) &gt; 20</span><br><span class="line">ORDER BY COUNT(*) DESC;</span><br></pre></td></tr></table></figure>

<h5 id="自连接-1"><a href="#自连接-1" class="headerlink" title="自连接"></a>自连接</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#3、自连接</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：查询员工的名字和其上级的名字</span><br><span class="line"></span><br><span class="line">SELECT e.last_name, m.last_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN employees AS m</span><br><span class="line">ON e.`manager_id` = m.`employee_id`;</span><br><span class="line"></span><br><span class="line">#案例：查询姓名中包含k的员工的名字和其上级的名字</span><br><span class="line"></span><br><span class="line">SELECT e.last_name, m.last_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">INNER JOIN employees AS m</span><br><span class="line">ON e.`manager_id` = m.`employee_id`</span><br><span class="line">WHERE e.`last_name` LIKE &#x27;%a%&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line">#二、外连接</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">应用场景：</span><br><span class="line">	用于查询一个表中有，另一个表中没有的记录</span><br><span class="line">特点：</span><br><span class="line">1、外连接的查询结果为主表中的所有记录，</span><br><span class="line">   如果从表中有和它匹配的，则显示匹配的值</span><br><span class="line">   如果从表中没有匹配的，则显示null</span><br><span class="line">   外连接查询结果 = 内连接结果 + 主表中有而从表中没有的记录</span><br><span class="line">2、左外连接，left join左边的是主表</span><br><span class="line">   右外连接, right join右边的是主表</span><br><span class="line">3、左外和右外交换两个表的顺序，结果一样</span><br><span class="line">4、全连接 = 内连接 + 表1中有但表2中没有的 + 表2中有但表1中没有的</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#引入：查询男朋友不在男神表的女神名</span><br><span class="line"></span><br><span class="line">#左外连接</span><br><span class="line">SELECT b.name</span><br><span class="line">FROM beauty AS b</span><br><span class="line">LEFT OUTER JOIN boys AS bo</span><br><span class="line">ON b.`boyfriend_id` = bo.`id`</span><br><span class="line">WHERE bo.id IS NULL;</span><br><span class="line"></span><br><span class="line">#右外连接</span><br><span class="line">SELECT b.name</span><br><span class="line">FROM boys AS bo</span><br><span class="line">RIGHT OUTER JOIN beauty AS b</span><br><span class="line">ON b.`boyfriend_id` = bo.`id`</span><br><span class="line">WHERE bo.id IS NULL;</span><br><span class="line"></span><br><span class="line">#案例1：查询哪个部门没有员工</span><br><span class="line"></span><br><span class="line">#左外</span><br><span class="line">SELECT d.*, employee_id</span><br><span class="line">FROM departments AS d</span><br><span class="line">LEFT OUTER JOIN employees AS e</span><br><span class="line">ON d.`department_id` = e.`department_id`</span><br><span class="line">WHERE e.employee_id IS NULL;</span><br><span class="line"></span><br><span class="line">#右外</span><br><span class="line">SELECT d.*, employee_id</span><br><span class="line">FROM employees AS e</span><br><span class="line">RIGHT OUTER JOIN departments AS d</span><br><span class="line">ON d.`department_id` = e.`department_id`</span><br><span class="line">WHERE e.employee_id IS NULL;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#全外连接</span><br><span class="line"></span><br><span class="line">SELECT b.*, bo.*</span><br><span class="line">FROM beauty AS b</span><br><span class="line">FULL OUTER JOIN boys AS bo</span><br><span class="line">ON b.`boyfriend_id` = bo.id;</span><br></pre></td></tr></table></figure>

<h4 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line">#三、交叉连接</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">## 笛卡尔乘积</span><br><span class="line"></span><br><span class="line">SELECT b.*, bo.*</span><br><span class="line">FROM beauty b</span><br><span class="line">CROSS JOIN boys bo;</span><br></pre></td></tr></table></figure>

<ul>
<li>SQL92和SQL99<ul>
<li>功能<ul>
<li>SQL99支持较多</li>
</ul>
</li>
<li>可读性<ul>
<li>SQL99可读性更高</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><ul>
<li>含义<ul>
<li>出现在其它语句中的select语句，又称为子查询或内查询</li>
<li>外部的查询语句，称为主查询或外查询</li>
</ul>
</li>
<li>分类<ul>
<li>按子查询出现的位置<ul>
<li>select 后面<ul>
<li>仅支持标量子查询</li>
</ul>
</li>
<li>from 后面<ul>
<li>支持表子查询</li>
</ul>
</li>
<li>where&#x2F;having 后面<ul>
<li>标量子查询</li>
<li>列子查询</li>
<li>行子查询</li>
</ul>
</li>
<li>exists 后面（相关子查询）<ul>
<li>表子查询</li>
</ul>
</li>
</ul>
</li>
<li>按结果集的行列数不同<ul>
<li>标量子查询（结果集只有1行1列）</li>
<li>列子查询（结果集只有1列多行）</li>
<li>行子查询（结果集有1行多列，多行多列）</li>
<li>表子查询（结果集一般为多行多列</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="where-having后面"><a href="#where-having后面" class="headerlink" title="where\having后面"></a>where\having后面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line"># 一、where或having后面</span><br><span class="line">#####</span><br><span class="line">/*</span><br><span class="line">1、标量子查询（单行子查询）</span><br><span class="line">2、列子查询（多行子查询）</span><br><span class="line">3、行子查询（多列多行）</span><br><span class="line"></span><br><span class="line">特点：</span><br><span class="line">1、子查询都放在小括号内</span><br><span class="line">2、子查询一般放在条件的右侧</span><br><span class="line">3、标量子查询，一般搭配着单行操作符使用：&gt; &lt; &gt;= &lt;= = &lt;&gt;</span><br><span class="line">   列子查询，一般搭配着多行操作符使用：in, any/some, all</span><br><span class="line">   </span><br><span class="line">4、子查询优先于主查询</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">#1、标量子查询</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：谁的工资比abel高</span><br><span class="line"></span><br><span class="line">SELECT last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &gt; (</span><br><span class="line">	SELECT salary </span><br><span class="line">	FROM employees </span><br><span class="line">	WHERE last_name = &#x27;abel&#x27;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#案例2：返回job_id与141号员工相同，salary比143号员工多的员工 姓名，job_id和工资</span><br><span class="line"></span><br><span class="line">SELECT </span><br><span class="line">  last_name,</span><br><span class="line">  job_id,</span><br><span class="line">  salary </span><br><span class="line">FROM</span><br><span class="line">  employees </span><br><span class="line">WHERE job_id = </span><br><span class="line">  (SELECT job_id </span><br><span class="line">  FROM employees </span><br><span class="line">  WHERE employee_id = 141)</span><br><span class="line">AND</span><br><span class="line">  salary &gt; </span><br><span class="line">  (SELECT salary </span><br><span class="line">  FROM employees </span><br><span class="line">  WHERE employee_id = 143) ;</span><br><span class="line"></span><br><span class="line">#案例3：返回公司工资最少的员工的last_name, job_id, salary</span><br><span class="line"></span><br><span class="line">SELECT last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary = (</span><br><span class="line">	SELECT MIN(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#案例4：查询最低工资大于50号部门最低工资的部门id和其最低工资</span><br><span class="line"></span><br><span class="line">SELECT department_id, MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MIN(salary) &gt; (</span><br><span class="line">	SELECT MIN(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE department_id = 50</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># 2、列子查询（多行子查询）</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：返回location_id 是1400或1700的部门中的所有员工姓名</span><br><span class="line"></span><br><span class="line">SELECT last_name</span><br><span class="line">FROM employees</span><br><span class="line">WHERE department_id IN (</span><br><span class="line">	SELECT department_id</span><br><span class="line">	FROM departments </span><br><span class="line">	WHERE `location_id` IN (1400,1700)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">SELECT last_name, d.location_id</span><br><span class="line">FROM employees AS e</span><br><span class="line">JOIN departments AS d </span><br><span class="line">ON e.`department_id` = d.`department_id`</span><br><span class="line">WHERE d.`location_id` IN (1400, 1700);</span><br><span class="line"></span><br><span class="line">#案例2：返回其它工种中比job_id为&#x27;IT_PROG&#x27;工种任一工资低的员工的</span><br><span class="line">#       员工号，姓名，job_id以及salary</span><br><span class="line"></span><br><span class="line">SELECT employee_id, last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id &lt;&gt; &#x27;IT_PROG&#x27;</span><br><span class="line">AND salary &lt; ANY (</span><br><span class="line">	SELECT DISTINCT salary</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">);</span><br><span class="line">-- 或者</span><br><span class="line">SELECT employee_id, last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id &lt;&gt; &#x27;IT_PROG&#x27;</span><br><span class="line">AND salary &lt; (</span><br><span class="line">	SELECT MAX(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">	);</span><br><span class="line">	</span><br><span class="line">#案例3：返回其它工种中比job_id为&#x27;IT_PROG&#x27;工种 所有 工资低的员工的</span><br><span class="line">#       员工号，姓名，job_id以及salary</span><br><span class="line">SELECT employee_id, last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id &lt;&gt; &#x27;IT_PROG&#x27;</span><br><span class="line">AND salary &lt; ALL (</span><br><span class="line">	SELECT DISTINCT salary</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">);</span><br><span class="line">-- 或者</span><br><span class="line">SELECT employee_id, last_name, job_id, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id &lt;&gt; &#x27;IT_PROG&#x27;</span><br><span class="line">AND salary &lt; (</span><br><span class="line">	SELECT MIN(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE job_id = &#x27;IT_PROG&#x27;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line"># 3、行子查询（结果集一行多列或多行多列）</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例：查询员工编号最小并且工资最高的员工信息</span><br><span class="line"></span><br><span class="line">-- 标量查询方法</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE employee_id = (</span><br><span class="line">	SELECT MIN(employee_id)</span><br><span class="line">	FROM employees</span><br><span class="line">) AND salary = (</span><br><span class="line">	SELECT MAX(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 行子查询格式</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE (employee_id, salary) = (</span><br><span class="line">	SELECT MIN(employee_id), MAX(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="select-后面"><a href="#select-后面" class="headerlink" title="select 后面"></a>select 后面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line"># 二、select后面</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">仅仅支持标量子查询，</span><br><span class="line">子查询结果只能1行1列</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#案例1：查询每个部门的员工个数</span><br><span class="line"></span><br><span class="line">SELECT d.*, (</span><br><span class="line">	SELECT COUNT(*)</span><br><span class="line">	FROM employees AS e</span><br><span class="line"> 	WHERE e.department_id = d.department_id</span><br><span class="line">) 员工个数</span><br><span class="line">FROM departments d;</span><br><span class="line"></span><br><span class="line">#案例2：查询员工号为102的部门名</span><br><span class="line"></span><br><span class="line">SELECT (</span><br><span class="line">	SELECT department_name</span><br><span class="line">	FROM departments d</span><br><span class="line">	INNER JOIN employees e</span><br><span class="line">	ON d.department_id = e.department_id</span><br><span class="line">	WHERE employee_id = 102</span><br><span class="line">) 部门名;</span><br></pre></td></tr></table></figure>

<h3 id="from后面"><a href="#from后面" class="headerlink" title="from后面"></a>from后面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line"># 三、from后面</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">将子查询结果充当一张表，必需发起别名</span><br><span class="line">子查询中的select后如果有函数结果，对这个结果也要起别名，不然不好在主查询引用</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#案例：查询每个部门的平均工资和工资等级</span><br><span class="line"></span><br><span class="line">SELECT a.*, grade_level</span><br><span class="line">FROM job_grades AS g</span><br><span class="line">INNER JOIN (</span><br><span class="line">	SELECT department_id, AVG(salary) avg_salary</span><br><span class="line">	FROM employees</span><br><span class="line">	GROUP BY department_id</span><br><span class="line">)AS a </span><br><span class="line">ON a.avg_salary BETWEEN g.`lowest_sal` AND g.`highest_sal`;</span><br></pre></td></tr></table></figure>

<h3 id="exists后面"><a href="#exists后面" class="headerlink" title="exists后面"></a>exists后面</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#####</span><br><span class="line"># 四、exists后面（相关子查询）</span><br><span class="line">#####</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line">	exists(完整的查询语句)</span><br><span class="line">结果：</span><br><span class="line">	如果查询语句不为空，返回1；否则返回0</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#案例1：查询有员工的部门名</span><br><span class="line"></span><br><span class="line">SELECT department_name</span><br><span class="line">FROM departments d</span><br><span class="line">WHERE EXISTS(</span><br><span class="line">	SELECT *</span><br><span class="line">	FROM employees e</span><br><span class="line">	WHERE d.`department_id` = e.`department_id`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 或者</span><br><span class="line">SELECT department_name</span><br><span class="line">FROM departments</span><br><span class="line">WHERE department_id IN (SELECT DISTINCT department_id FROM employees)</span><br><span class="line"></span><br><span class="line">-- 或者</span><br><span class="line">SELECT DISTINCT department_name</span><br><span class="line">FROM departments d</span><br><span class="line">INNER JOIN employees AS e</span><br><span class="line">ON e.department_id = d.department_id;</span><br><span class="line"></span><br><span class="line">#案例2：查询没有女朋友的男神信息</span><br><span class="line"></span><br><span class="line">-- exists</span><br><span class="line">SELECT b.*</span><br><span class="line">FROM boys AS b</span><br><span class="line">WHERE NOT EXISTS(</span><br><span class="line">	SELECT *</span><br><span class="line">	FROM beauty be</span><br><span class="line">	WHERE b.id = be.`boyfriend_id`</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- in</span><br><span class="line">SELECT b.*</span><br><span class="line">FROM boys AS b</span><br><span class="line">WHERE b.id NOT IN (SELECT DISTINCT boyfriend_id FROM beauty);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><ul>
<li><p>应用场景</p>
<ul>
<li>当要显示的数据，一页显示不全，需要分布提交sql请求</li>
</ul>
</li>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">select 查询列表</span><br><span class="line">from 表名</span><br><span class="line">join type 表2</span><br><span class="line">on 连接条件</span><br><span class="line">where 筛选条件</span><br><span class="line">group by 分组字段 </span><br><span class="line">having 分组后的筛选条件</span><br><span class="line">order by 排序字段</span><br><span class="line">limit offset, size</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">offset：要显示条目的起始索引，起始索引从0开始</span><br><span class="line">size：要显示的条目个数</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
</li>
<li><p>特点</p>
<ol>
<li><p>limit语句放在查询语句的最后</p>
<ul>
<li>执行顺序：<ol>
<li>from</li>
<li>where</li>
<li>group by</li>
<li>having</li>
<li>select </li>
<li>order by </li>
<li>limit</li>
</ol>
</li>
</ul>
</li>
<li><p>公式</p>
<ul>
<li><p>要显示的页数是第page页, 每页的条目数size</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select 查询列表</span><br><span class="line">from 表</span><br><span class="line">limit size*(page-1), size</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#案例1：查询前5条员工信息</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">LIMIT 0, 5;</span><br><span class="line">-- 或者在Limit后只跟一个数，默认从索引0开始，数表示 size</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">LIMIT 5;</span><br><span class="line"></span><br><span class="line">#案例2：查询第11条到第25条</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">LIMIT 10, 15;</span><br><span class="line"></span><br><span class="line">#案例3：有奖金的员工信息，并且工资较高的前10名</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE commission_pct IS NOT NULL</span><br><span class="line">ORDER BY salary DESC</span><br><span class="line">LIMIT 10;</span><br></pre></td></tr></table></figure>

<h2 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h2><ul>
<li><p><code>union</code>联合，合并：将多条查询语句的结果合并成一个结果，相当于对两个查询结果进行纵向拼接，过程中需要自己保证列数和列含义一致</p>
</li>
<li><p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查询语句1</span><br><span class="line">union</span><br><span class="line">查询语句2</span><br><span class="line">union</span><br><span class="line">查询语句3</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>应用场景</p>
<ol>
<li>筛选条件过于复杂的情况下用于拆分</li>
<li>要查询的结果来自于多个表，且多个表没有直接的连接关系，但查询的信息一致时</li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li>要求多条查询语句的查询列数一致</li>
<li>要求多条查询语句的查询的每一列的类型和顺序一致（保证列的含义的相同）</li>
<li>union关键字默认是去重的，如果使用<code>union all</code>可以包含重复项</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#引入：查询部门编号大于90或邮箱中包含a的员工信息</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE email LIKE &#x27;%a%&#x27; OR department_id &gt; 90;</span><br><span class="line"></span><br><span class="line">-- 联合查询</span><br><span class="line"></span><br><span class="line">SELECT * FROM employees WHERE email LIKE &#x27;%a%&#x27;</span><br><span class="line">UNION</span><br><span class="line">SELECT * FROM employees WHERE department_id &gt; 90;</span><br><span class="line"></span><br><span class="line">#案例：查询中国用户中男性的信息，以及外国用户中的男性信息，返回在一张表中</span><br><span class="line"></span><br><span class="line">SELECT id, cname, csex FROM t_ca WHERE csex = &#x27;男&#x27;</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT t_id, tName, tGender FROM t_ua WHERE tGender = &#x27;male&#x27;;</span><br></pre></td></tr></table></figure>





<h1 id="DML语言"><a href="#DML语言" class="headerlink" title="DML语言"></a>DML语言</h1><ul>
<li>DML : Data Manage Language</li>
<li>数据操作语言<ul>
<li>插入：insert</li>
<li>修改：update</li>
<li>删除：delete</li>
</ul>
</li>
</ul>
<h2 id="插入语句"><a href="#插入语句" class="headerlink" title="插入语句"></a>插入语句</h2><h3 id="方式一（经典插入）"><a href="#方式一（经典插入）" class="headerlink" title="方式一（经典插入）"></a>方式一（经典插入）</h3><ul>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名(列名1, 列名2,...)</span><br><span class="line">values(值1, 值2,...);</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#1、插入的值的类型要与列的类型一致或兼容</span><br><span class="line"></span><br><span class="line">INSERT INTO beauty(id, `name`, sex, borndate, phone, photo, boyfriend_id)</span><br><span class="line">VALUES(13,&#x27;唐艺昕&#x27;,&#x27;女&#x27;,&#x27;1990-04-23&#x27;,&#x27;18988888888&#x27;,NULL,2);</span><br><span class="line"></span><br><span class="line">#2、不可以为null的列必须插入值，可以为null的列如何插入值？</span><br><span class="line">-- 方式一：写明null</span><br><span class="line">INSERT INTO beauty(id, `name`, sex, borndate, phone, photo, boyfriend_id)</span><br><span class="line">VALUES(13,&#x27;唐艺昕&#x27;,&#x27;女&#x27;,&#x27;1990-04-23&#x27;,&#x27;18988888888&#x27;,NULL,2);</span><br><span class="line"></span><br><span class="line">-- 方式二：在表的字段中不写出，values中也不写这个字段的值</span><br><span class="line">INSERT INTO beauty(id, `name`, sex, phone)</span><br><span class="line">VALUES(15,&#x27;娜扎&#x27;,&#x27;女&#x27;,&#x27;19988888888&#x27;);</span><br><span class="line"></span><br><span class="line">#3、列的顺序可以调换，只要保证values中对应就可以</span><br><span class="line">INSERT INTO beauty(`name`, sex, id, phone)</span><br><span class="line">VALUES(&#x27;蒋欣&#x27;, &#x27;女&#x27;, 16, &#x27;521&#x27;);</span><br><span class="line"></span><br><span class="line">#4、列数和值的个数必须一致，即使是nullable的列，只要写了，一定要给值</span><br><span class="line"></span><br><span class="line">#5、可以省略列名，但默认是包含了所有列，而且列的顺序和表中列的顺序一致</span><br><span class="line"></span><br><span class="line">INSERT INTO beauty</span><br><span class="line">VALUES(18,&#x27;张飞&#x27;,&#x27;男&#x27;,NULL,&#x27;119&#x27;,NULL,NULL);</span><br></pre></td></tr></table></figure>

<h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><ul>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名</span><br><span class="line">set 列名1=值1， 列名2=值2, ...</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty</span><br><span class="line">SET id = 19, NAME = &#x27;刘涛&#x27;, phone = &#x27;999&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="两种方式对比"><a href="#两种方式对比" class="headerlink" title="两种方式对比"></a>两种方式对比</h3><ul>
<li><p>方式一支持一次插入多行，方式二不支持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty</span><br><span class="line">VALUES(23,&#x27;唐艺昕1&#x27;,&#x27;女&#x27;,&#x27;1990-04-23&#x27;,&#x27;18988888888&#x27;,NULL,2)</span><br><span class="line">,(24,&#x27;唐艺昕2&#x27;,&#x27;女&#x27;,&#x27;1990-04-23&#x27;,&#x27;18988888888&#x27;,NULL,2)</span><br><span class="line">,(25,&#x27;唐艺昕3&#x27;,&#x27;女&#x27;,&#x27;1990-04-23&#x27;,&#x27;18988888888&#x27;,NULL,2);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式一支持子查询，方式二不支持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO beauty(id, NAME, phone)</span><br><span class="line">SELECT 26,&#x27;宋莤&#x27;,&#x27;123456&#x27;;</span><br><span class="line"></span><br><span class="line">INSERT INTO beauty(id, NAME, phone)</span><br><span class="line">SELECT id, boyname, &#x27;654321&#x27;</span><br><span class="line">FROM boys WHERE id &lt; 3;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="修改语句"><a href="#修改语句" class="headerlink" title="修改语句"></a>修改语句</h2><ul>
<li><p>语法</p>
<ul>
<li><p>修改单表的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update 表名</span><br><span class="line">set 列1=新值1, 列2=新值2, ...</span><br><span class="line">where 筛选条件;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改多表的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">【sql92语法】</span><br><span class="line">update 表1 别名, 表2 别名</span><br><span class="line">set 列=值, ...</span><br><span class="line">where 连接条件</span><br><span class="line">and 筛选条件</span><br><span class="line"></span><br><span class="line">【sql99语法】</span><br><span class="line">update 表1 别名,</span><br><span class="line">inner|left|right join 表2 别名</span><br><span class="line">on 连接条件</span><br><span class="line">set 列=值, ...</span><br><span class="line">where 筛选条件;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#1、修改单表的记录</span><br><span class="line"></span><br><span class="line">#案例1：修改beauty中姓唐的女神的电话为13899888899</span><br><span class="line"></span><br><span class="line">UPDATE beauty</span><br><span class="line">SET phone = &#x27;13899888899&#x27;</span><br><span class="line">WHERE `name` LIKE &#x27;唐%&#x27;;</span><br><span class="line"></span><br><span class="line">#案例2：修改boys表中id好友为2的名称为张飞，魅力值为10</span><br><span class="line"></span><br><span class="line">UPDATE boys</span><br><span class="line">SET boyName = &#x27;张飞&#x27;, userCP = 10</span><br><span class="line">WHERE id = 2;</span><br><span class="line"></span><br><span class="line">#2、修改多表的记录</span><br><span class="line"></span><br><span class="line">#案例1：修改张无忌的女朋友的手机号114</span><br><span class="line"></span><br><span class="line">UPDATE beauty b</span><br><span class="line">INNER JOIN boys bo</span><br><span class="line">ON b.`boyfriend_id` = bo.`id`</span><br><span class="line">SET b.`phone` = &#x27;114&#x27;</span><br><span class="line">WHERE bo.`boyName` = &#x27;张无忌&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例2：修改没有男朋友的女神的男朋友编号都为2号</span><br><span class="line"></span><br><span class="line">UPDATE beauty AS b</span><br><span class="line">LEFT JOIN boys AS bo</span><br><span class="line">ON b.`boyfriend_id` = bo.`id`</span><br><span class="line">SET b.`boyfriend_id` = 2</span><br><span class="line">WHERE bo.id IS NULL;</span><br></pre></td></tr></table></figure>



<h2 id="删除语句"><a href="#删除语句" class="headerlink" title="删除语句"></a>删除语句</h2><ul>
<li><p>语法</p>
<ul>
<li><p>方式一：<code>delete</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 1、单表的删除 </span><br><span class="line">delete from 表名</span><br><span class="line">where 筛选条件</span><br><span class="line"></span><br><span class="line">-- 2、多表的删除</span><br><span class="line">【sql92】</span><br><span class="line">delete 表1的别名,表2的别名</span><br><span class="line">from 表1 别名1, 表2 别名2</span><br><span class="line">where 连接条件</span><br><span class="line">and 筛选条件</span><br><span class="line"></span><br><span class="line">【sql99】</span><br><span class="line">delete 表1的别名,表2的别名</span><br><span class="line">from 表1 别名</span><br><span class="line">inner|left|right join 表2 别名</span><br><span class="line">on 连接条件</span><br><span class="line">where 筛选条件</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：<code>truncate</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate table 表名; -- 直接删除整个表</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#方式一：delete</span><br><span class="line"></span><br><span class="line">#1、单表的删除</span><br><span class="line"></span><br><span class="line">#案例1：删除手机号最后一位为9的女神信息</span><br><span class="line"></span><br><span class="line">DELETE FROM beauty</span><br><span class="line">WHERE phone LIKE &#x27;%9&#x27;;</span><br><span class="line"></span><br><span class="line">#2、多表的删除</span><br><span class="line"></span><br><span class="line">#案例1：删除张无忌的女朋友信息</span><br><span class="line"></span><br><span class="line">DELETE b</span><br><span class="line">FROM beauty b</span><br><span class="line">INNER JOIN boys bo</span><br><span class="line">ON b.`boyfriend_id` = bo.`id`</span><br><span class="line">WHERE bo.`boyName` = &#x27;张无忌&#x27;;</span><br><span class="line"></span><br><span class="line">#案例2：删除黄晓明的信息以及他女朋友的信息</span><br><span class="line"></span><br><span class="line">DELETE b, bo</span><br><span class="line">FROM beauty b</span><br><span class="line">INNER JOIN boys bo</span><br><span class="line">ON b.`boyfriend_id` = bo.`id`</span><br><span class="line">WHERE bo.`boyName` = &#x27;黄晓明&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#方式二：truncate语句 </span><br><span class="line"></span><br><span class="line">TRUNCATE TABLE boys; -- 将boys表的数据全部删除，但表仍是存在的，是不过是空表，truncate无法添加where筛选条件</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>delete</code> 与<code>truncate</code>对比【面试题✨】</p>
<ol>
<li><code>delete</code>可以添加<code>where</code>条件，<code>truncate</code>不能加</li>
<li><code>truncate</code>删除的效率要高一点点</li>
<li>假如要删除的表中有自增长列，如果用<code>delete</code>删除后，再插入数据，自增长列的值从断点处开始；而<code>truncate</code>删除后，再插入数据，自增长列的值从1开始</li>
<li><code>truncate</code>删除没有返回值，<code>delete</code>删除有返回值：返回几行受影响</li>
<li><code>truncate</code>删除不能回滚，<code>delete</code>删除可以回滚</li>
</ol>
</li>
</ul>
<h1 id="DDL语言"><a href="#DDL语言" class="headerlink" title="DDL语言"></a>DDL语言</h1><ul>
<li><p>DDL : Data Define Language</p>
</li>
<li><p>数据定义语言：库和表的管理</p>
<ul>
<li>库的管理：创建、修改、删除</li>
<li>表的管理：创建、修改、删除</li>
<li>创建：<code>create</code></li>
<li>修改：<code>alter</code></li>
<li>删除：<code>drop</code></li>
</ul>
</li>
</ul>
<h2 id="库的管理"><a href="#库的管理" class="headerlink" title="库的管理"></a>库的管理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#1、库的创建</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line">CREATE DATABASE 库名;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE DATABASE [IF NOT EXISTS] 库名;</span><br><span class="line">-- 如果库不存在则创建，如果存在则不创建且不报错</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#案例：创建库books</span><br><span class="line"></span><br><span class="line">CREATE DATABASE IF NOT EXISTS books;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">#2、库的修改</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">-- 改库名，已经不能用了 </span><br><span class="line">rename database books to bookss;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#更改库的字符集</span><br><span class="line"></span><br><span class="line">ALTER DATABASE books CHARACTER SET gbk;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">#3、库的删除</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">DROP DATABASE books;</span><br><span class="line"></span><br><span class="line">-- 下面的语句可以在不存在库的情况下不报错</span><br><span class="line">DROP DATABASE IF EXISTS books;</span><br></pre></td></tr></table></figure>

<h2 id="表的管理"><a href="#表的管理" class="headerlink" title="表的管理"></a>表的管理</h2><h3 id="表的创建"><a href="#表的创建" class="headerlink" title="表的创建"></a>表的创建</h3><ul>
<li><p>语法 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】,</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】,</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】,</span><br><span class="line">	...</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】</span><br><span class="line">    )</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#1、表的创建</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line">    create table if not exists 表名(</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】,</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】,</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】,</span><br><span class="line">	...</span><br><span class="line">	列名 列的类型【(列的长度) 列的约束】</span><br><span class="line">    )</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#案例1：创建book表</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS book(</span><br><span class="line">	id INT, -- 编号</span><br><span class="line">	bNname VARCHAR(20), -- 书名</span><br><span class="line">	price DOUBLE, -- 价格</span><br><span class="line">	authorid INT, -- 作者编号</span><br><span class="line">	publishDate DATETIME -- 出版日期</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">DESC book;</span><br><span class="line"></span><br><span class="line">#案例2：创建表author</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS author(</span><br><span class="line">	id INT, </span><br><span class="line">	au_name VARCHAR(20),</span><br><span class="line">	nation VARCHAR(10)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">DESC author;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="表的修改"><a href="#表的修改" class="headerlink" title="表的修改"></a>表的修改</h3><ul>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 add|drop|modify|change column  列名 【列类型 约束】;</span><br><span class="line"></span><br><span class="line">alter table 表名 rename to 新表名;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#2、表的修改</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">##（1）、修改列名</span><br><span class="line"></span><br><span class="line">#案例1：修改book表中publishDate为pubDate</span><br><span class="line"></span><br><span class="line">ALTER TABLE book CHANGE COLUMN publishDate pubDate DATETIME;</span><br><span class="line"></span><br><span class="line">##（2）、修改列的类型或约束</span><br><span class="line"></span><br><span class="line">#案例1：修改book表pubdate的类型为timestamp</span><br><span class="line"></span><br><span class="line">ALTER TABLE book MODIFY COLUMN pubdate TIMESTAMP;</span><br><span class="line"></span><br><span class="line">##（3）、添加新列</span><br><span class="line"></span><br><span class="line">#案例1：给author表中新添加一列年薪</span><br><span class="line"></span><br><span class="line">ALTER TABLE author ADD COLUMN annual DOUBLE【first|after字段名 （默认添加在最后，fisrt:添加为第一个字段，after字段：添加在字段后 ）】;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##（4）、删除列</span><br><span class="line"></span><br><span class="line">#案例1：删除author表的年薪列</span><br><span class="line"></span><br><span class="line">ALTER TABLE author DROP COLUMN annual;</span><br><span class="line"></span><br><span class="line">##（5）、修改表名</span><br><span class="line"></span><br><span class="line">#案例1：修改author表名为book_author</span><br><span class="line"></span><br><span class="line">ALTER TABLE author RENAME TO book_author;</span><br></pre></td></tr></table></figure>

<h3 id="表的删除"><a href="#表的删除" class="headerlink" title="表的删除"></a>表的删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#3、表的删除</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">#案例1：删除表book_author</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS book_author;</span><br><span class="line"></span><br><span class="line">SHOW TABLES; -- 查看当前库的所有表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#新建库、表的通用写法</span><br><span class="line"></span><br><span class="line">DROP DATABASE IF EXISTS 旧库名;</span><br><span class="line">CREATE DATABASES 新库名;</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS 旧表名;</span><br><span class="line">CREATE TABLE 新表名();</span><br></pre></td></tr></table></figure>





<h3 id="表的复制"><a href="#表的复制" class="headerlink" title="表的复制"></a>表的复制</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#4、表的复制 </span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">INSERT INTO author</span><br><span class="line">VALUES(1,&#x27;村上春树&#x27;,&#x27;日本&#x27;)</span><br><span class="line">,(2,&#x27;莫言&#x27;,&#x27;中国&#x27;)</span><br><span class="line">,(3,&#x27;冯唐&#x27;,&#x27;中国&#x27;)</span><br><span class="line">,(4,&#x27;金庸&#x27;,&#x27;中国&#x27;);</span><br><span class="line"></span><br><span class="line">#1、仅仅复制表的结构</span><br><span class="line"></span><br><span class="line">CREATE TABLE copy LIKE author;</span><br><span class="line"></span><br><span class="line">#2、同时复制表的结构和全部数据</span><br><span class="line"></span><br><span class="line">CREATE TABLE copy2</span><br><span class="line">SELECT * FROM author;</span><br><span class="line"></span><br><span class="line">#3、复制表的结构，但只有部分数据（部分列或者部分记录都行）添加筛选条件</span><br><span class="line"></span><br><span class="line">CREATE TABLE copy3</span><br><span class="line">SELECT id, au_name FROM author WHERE nation = &#x27;中国&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#4、复制表的结构，但只是部分结构</span><br><span class="line"></span><br><span class="line">CREATE TABLE copy4</span><br><span class="line">SELECT id, au_name</span><br><span class="line">FROM author</span><br><span class="line">WHERE 1=2; -- 没有记录可以满足这个条件，故最终只复制了表结构, where 0;也行</span><br><span class="line"></span><br><span class="line">-- 下面的方法也行</span><br><span class="line">CREATE TABLE copy5</span><br><span class="line">SELECT id, au_name</span><br><span class="line">FROM author</span><br><span class="line">LIMIT 0,0;</span><br></pre></td></tr></table></figure>

<h2 id="常见的数据类型"><a href="#常见的数据类型" class="headerlink" title="常见的数据类型"></a>常见的数据类型</h2><ul>
<li>常见的数据类型<ul>
<li>数值型：<ul>
<li>整形</li>
<li>小数<ul>
<li>定点数</li>
<li>浮点数</li>
</ul>
</li>
</ul>
</li>
<li>字符型<ul>
<li>较短的文本<ul>
<li>char</li>
<li>varchar</li>
</ul>
</li>
<li>较长的文本<ul>
<li>text</li>
<li>blob(较长的二进制数据，如图片)</li>
</ul>
</li>
</ul>
</li>
<li>日期型</li>
</ul>
</li>
</ul>
<h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><table>
<thead>
<tr>
<th>整数类型</th>
<th>字节</th>
<th>范围</th>
</tr>
</thead>
<tbody><tr>
<td>Tinyint</td>
<td>1</td>
<td>有符号：-128-127<br />无符号：0-255</td>
</tr>
<tr>
<td>Smallint</td>
<td>2</td>
<td>有符号：-32768<del>32767<br />无符号：0</del>65535</td>
</tr>
<tr>
<td>Mdeiumint</td>
<td>3</td>
<td>有符号：-8388608<del>8388607<br />无符号：0</del>1677215</td>
</tr>
<tr>
<td>Int, integer</td>
<td>4</td>
<td>有符号：-2147483648~2147483647<br />无符号：0-4294967295</td>
</tr>
<tr>
<td>Bigint</td>
<td>8</td>
<td>-</td>
</tr>
</tbody></table>
<ul>
<li>分类<ul>
<li>tinyint, smallint, mediumint ,int, bigint</li>
</ul>
</li>
<li>特点<ul>
<li>如果设置无符号还是有符号，默认是有符号；如果想设置无符号，需要添加<code>unsigned</code>关键字</li>
<li>如果插入的数值超过了类型的范围，会报<code>out of range</code>异常或直接报错(8.0版本)，并且插入临界值（对应超过的方向）</li>
<li>如果不设置长度，会有默认长度，长度代表了显示的最大宽度，如果表中的数值长度小于设定的长度，且在字段受关键字<code>zerofill</code>约束，则会在左边用<code>0</code>填充</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#1.如何设置无符号和有符号</span><br><span class="line"></span><br><span class="line">CREATE TABLE tab_int(</span><br><span class="line">	t1 INT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_int</span><br><span class="line">VALUES(-1),(2);  -- 默认是有符号类型</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS tab_int;</span><br><span class="line"></span><br><span class="line">CREATE TABLE tab_int(</span><br><span class="line">	t1 INT(20),</span><br><span class="line">	t2 INT UNSIGNED</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_int</span><br><span class="line">VALUES(-1,-2); # -2向下超过了数据的范围，会变成0</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_int</span><br><span class="line">VALUES(999999999999,1); #999999999999向上超过了int的范围，设置的是临界值2147483647</span><br></pre></td></tr></table></figure>



<h3 id="小数"><a href="#小数" class="headerlink" title="小数"></a>小数</h3><ul>
<li>浮点型<ul>
<li><code>float</code>， 4字节</li>
<li><code>double</code>， 8字节</li>
</ul>
</li>
<li>定点型<ul>
<li><code>DEC(M,D) / DECIMAL(M,D)</code>， M+2字节， 相比于浮点型更精确</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">分类：</span><br><span class="line">	1.浮点型</span><br><span class="line">	float(M,D)</span><br><span class="line">	double(M,D)</span><br><span class="line"></span><br><span class="line">	2.定点型</span><br><span class="line">	dec(M,D)</span><br><span class="line">	decimal(M,D)</span><br><span class="line">	</span><br><span class="line">特点：</span><br><span class="line">    1.M和D</span><br><span class="line">	M：代表整数部位和小数部位的长度</span><br><span class="line">	D：小数部位的长度</span><br><span class="line">	Note：小数前的数值长度就固定在M-D了，如果超过范围，插入临界值</span><br><span class="line">    2.M和D都可以省略</span><br><span class="line">	如果是decimal，则M默认为10，D默认为0</span><br><span class="line">	如果是float和double，则会根据插入数值的精度来决定精度</span><br><span class="line">	</span><br><span class="line">    3.定点型的精确度高，如果要求插入数值的精度较高如货币运算则用考虑使用</span><br><span class="line">    </span><br><span class="line">原则:</span><br><span class="line">    所选择的类型越简单越好，在不影响数据完整性前提下，所占内存越小越好</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#测试M和D的含义</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS tab_float(</span><br><span class="line">	f1 FLOAT(5,2),</span><br><span class="line">	f2 DOUBLE(5,2),</span><br><span class="line">	f3 DECIMAL(5,2)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_float</span><br><span class="line">VALUES(123.45,123.45,123.45)</span><br><span class="line">,(123.456,123.456,123.456)</span><br><span class="line">,(1234.5,1234.5,1234.5);</span><br><span class="line"></span><br><span class="line">SELECT * FROM tab_float;</span><br><span class="line"></span><br><span class="line">DELETE FROM tab_float;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h3><ul>
<li>较短的文本：<ul>
<li><code>char(M)</code>：M表示最大的字<strong>符</strong>数，下同。M可以省略，默认为1</li>
<li><code>varchar(M)</code>：M不可以省略</li>
<li>区别：char表示固定长度（无论保存的值多少长度，内存空间一样大），varchar表示可变长度（根据实际数据开辟内存空间）</li>
</ul>
</li>
<li>较长的文本<ul>
<li>text</li>
<li>blob</li>
</ul>
</li>
<li>其它<ul>
<li>binary和varbinary用于保存较短的二进制</li>
<li>enum用于保存枚举</li>
<li>set用于保存集合</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">	写法		M的意思		特点		空间耗费	效率</span><br><span class="line">char 	char(M)		最大的字符数	固定长度的字符 	比较耗费	高</span><br><span class="line"></span><br><span class="line">varchar varchar(M)	最大的字符数	可变长度的字符	比较节省	低</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#enum枚举类型</span><br><span class="line"></span><br><span class="line">CREATE TABLE tab_char(</span><br><span class="line">	c1 ENUM(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- c1字段只能输入a,b,c三类字符</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_char</span><br><span class="line">VALUES(&#x27;a&#x27;),(&#x27;b&#x27;),(&#x27;d&#x27;),(&#x27;B&#x27;);  -- 第三行记录是空值</span><br><span class="line"></span><br><span class="line">SELECT * FROM tab_char;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#set类型</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS tab_set(</span><br><span class="line">	s1 SET(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;d&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO tab_set VALUES (&#x27;a&#x27;);</span><br><span class="line">INSERT INTO tab_set VALUES (&#x27;a,b&#x27;);</span><br><span class="line">INSERT INTO tab_set VALUES (&#x27;a,b,c&#x27;);</span><br><span class="line">INSERT INTO tab_set VALUES (&#x27;a,b,c,d&#x27;);</span><br><span class="line">INSERT INTO tab_set VALUES (&#x27;a,D,E&#x27;); -- e会忽视掉</span><br><span class="line"></span><br><span class="line">SELECT * FROM tab_set;</span><br></pre></td></tr></table></figure>

<h3 id="日期型"><a href="#日期型" class="headerlink" title="日期型"></a>日期型</h3><table>
<thead>
<tr>
<th>日期和时间</th>
<th>字节</th>
<th>最小值</th>
<th>最大值</th>
</tr>
</thead>
<tbody><tr>
<td>date</td>
<td>4</td>
<td>1000-01-01</td>
<td>9999-12-31</td>
</tr>
<tr>
<td>datetime</td>
<td>8</td>
<td>1000-01-01 00:00:00</td>
<td>9999-12-31 23:59:59</td>
</tr>
<tr>
<td>timestamp</td>
<td>4</td>
<td>19700101080001</td>
<td>2038年的某个时刻</td>
</tr>
<tr>
<td>time</td>
<td>3</td>
<td>-838:59:59</td>
<td>838:59:59</td>
</tr>
<tr>
<td>year</td>
<td>1</td>
<td>1901</td>
<td>2155</td>
</tr>
</tbody></table>
<ul>
<li><p>datetime和timestamp比较</p>
<ul>
<li><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>范围</th>
<th>时区等的影响</th>
</tr>
</thead>
<tbody><tr>
<td>datetime</td>
<td>8</td>
<td>1000-1-1~9999-12-31</td>
<td>不受</td>
</tr>
<tr>
<td>timestamp</td>
<td>4</td>
<td>1970-2038</td>
<td>受</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tab_date(</span><br><span class="line">	t1 DATETIME,</span><br><span class="line">	t2 TIMESTAMP</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_date VALUES (NOW(), NOW());</span><br><span class="line"></span><br><span class="line">SELECT * FROM tab_date;</span><br></pre></td></tr></table></figure>



<h2 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h2><ul>
<li><p>含义：一种限制，用于限制表中的数据，为了最终保证表中数据的准确性和可靠性</p>
</li>
<li><p>分类：六大约束</p>
<ul>
<li>not null：非空约束，用于保证该字段的值不能为空，比如姓名，学号 </li>
<li>default：默认约束，用于保证该字段有默认值，比如性别</li>
<li>primary key：主键，用于保证该字段的值具有唯一性，并且非空</li>
<li>unique：唯一约束，用于保证该字段的值具有唯一性，可以为空，比如座位号</li>
<li>check：检查约束【mysql中不支持】，比如年龄、性别</li>
<li>foreign key：外键，用于限制两个表的关系，用于保证该字段的值来自于主表的关联列的值，在从表中添加外键约束，用于引用主表中某列的值，比如学生表的专业编号，员工表的部门编号、工种编号</li>
</ul>
</li>
<li><p>添加约束的时机：</p>
<ul>
<li>创建表时</li>
<li>修改表时（数据添加之前）</li>
</ul>
</li>
<li><p>约束的添加分类</p>
<ul>
<li><p>列级约束：六大约束语法上都支持，但外键约束没有效果</p>
</li>
<li><p>表级约束：除了非空和默认，其它都支持</p>
<ul>
<li><pre><code class="mysql">create table test(
    c1 字段类型 列级约束,
     c2 字段类型,
     表级约束
)
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 🎉**主键和唯一的对比**：</span><br><span class="line"></span><br><span class="line">  - | 类型 | 保证唯一性 | 是否允许 为空 | 一个表中可以有多少个 | 是否允许组合                              |</span><br><span class="line">    | ---- | ---------- | ------------- | -------------------- | ----------------------------------------- |</span><br><span class="line">    | 主键 | 能         | 不允许        | 至多有1个            | 允许 `primary key(id, stuName)`，但不推荐 |</span><br><span class="line">    | 唯一 | 能         | 允许          | 可以有多个           | 允许 `unique(seat,seat2)`，但不推荐       |</span><br><span class="line"></span><br><span class="line">- 🎉外键的特点</span><br><span class="line"></span><br><span class="line">  1. 要求在从表中设置外键关系</span><br><span class="line"></span><br><span class="line">  2. 从表的外键列的类型和主表的对应列（关联列）的类型一致或兼容，名称无要求</span><br><span class="line"></span><br><span class="line">  3. 要求主表中的关联列必须是一个key（一般是**主键**或唯一）</span><br><span class="line"></span><br><span class="line">  4. 插入数据时，先插入主表的数据，再插入从表的数据（如先给major表中有数据后，stuinfo中才可以对majorId进行填充值）</span><br><span class="line"></span><br><span class="line">     删除数据时，先删除从表，再删除主表（因为从表以外键的方式与主表的key锁定了</span><br><span class="line"></span><br><span class="line">### 创建表时添加约束</span><br><span class="line"></span><br><span class="line">|          | 支持类型       | 可以起约束名                                         |</span><br><span class="line">| -------- | -------------- | ---------------------------------------------------- |</span><br><span class="line">| 列级约束 | 除了外键       | 不可以                                               |</span><br><span class="line">| 表级约束 | 除了非空和默认 | 可以，但对主键无效（无论起什么名字，都会显示primary) |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```mysql</span><br><span class="line">##########</span><br><span class="line">#一、创建表时添加约束</span><br><span class="line">##########</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">#1、添加列级约束</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line">  直接在字段名和类型后面追加约束类型</span><br><span class="line">  </span><br><span class="line">只支持主键、非空、默认、唯一</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE DATABASE students;</span><br><span class="line">USE students;</span><br><span class="line"></span><br><span class="line">CREATE TABLE major( -- 方便后面的外键约束</span><br><span class="line">	id INT PRIMARY KEY,</span><br><span class="line">	majorName VARCHAR(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE stuinfo(</span><br><span class="line">	id INT PRIMARY KEY, #主键</span><br><span class="line">	stuName VARCHAR(20) NOT NULL, #非空</span><br><span class="line">	gender CHAR(1) CHECK(gender IN (&#x27;男&#x27;,&#x27;女&#x27;)), #检查 </span><br><span class="line">	seat INT UNIQUE, #唯一</span><br><span class="line">	age INT DEFAULT 20, #默认</span><br><span class="line">	majorId INT REFERENCES major(id)#外键</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">DESC stuinfo;</span><br><span class="line"></span><br><span class="line">#查看表中的所有索引列，包括主键，外键，唯一</span><br><span class="line">SHOW INDEX FROM stuinfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">#2、添加表级约束</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：在各个字段的最下面</span><br><span class="line">【constraint 自定义约束名 】约束类型(字段名)</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS stuinfo;</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS stuinfo(</span><br><span class="line">	id INT,</span><br><span class="line">	stuName VARCHAR(20),</span><br><span class="line">	gender CHAR(1),</span><br><span class="line">	seat INT,</span><br><span class="line">	age INT,</span><br><span class="line">	majorId INT,</span><br><span class="line">	</span><br><span class="line">	CONSTRAINT pk PRIMARY KEY(id),#主键，pk是自定义的约束名</span><br><span class="line">	CONSTRAINT uq UNIQUE(seat), #唯一</span><br><span class="line">	CONSTRAINT ck CHECK(gender = &#x27;男&#x27; OR gender = &#x27;女&#x27;), #检查</span><br><span class="line">	CONSTRAINT fk_stuinfo_mojor FOREIGN KEY(majorId) REFERENCES major(id)#外键</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">SHOW INDEX FROM stuinfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#通用的写法：</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS stuinfo(</span><br><span class="line">	id INT PRIMARY KEY,</span><br><span class="line">	stuName VARCHAR(20) NOT NULL,</span><br><span class="line">	gender CHAR(1),</span><br><span class="line">	age INT DEFAULT 18,</span><br><span class="line">	seat INT UNIQUE,</span><br><span class="line">	majorId INT,</span><br><span class="line">	</span><br><span class="line">	CONSTRAINT fk_stuinfo_mojor FOREIGN KEY(majorId) REFERENCES major(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="修改表时添加约束"><a href="#修改表时添加约束" class="headerlink" title="修改表时添加约束"></a>修改表时添加约束</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">##########</span><br><span class="line">#二、修改表时添加约束</span><br><span class="line">##########</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line"></span><br><span class="line">1、添加列级约束</span><br><span class="line">alter table 表名 modify column 字段名 字段类型 新约束;</span><br><span class="line"></span><br><span class="line">2、添加表级约束</span><br><span class="line">alter table 表名 add 【constraint 约束名】 约束类型(字段名)【外键的引用】</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS stuinfo;</span><br><span class="line">CREATE TABLE IF NOT EXISTS stuinfo(</span><br><span class="line">	id INT,</span><br><span class="line">	stuName VARCHAR(20),</span><br><span class="line">	gender CHAR(1),</span><br><span class="line">	seat INT,</span><br><span class="line">	age INT,</span><br><span class="line">	majorid INT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#1、添加非空约束</span><br><span class="line"></span><br><span class="line">#案例：对stuName列添加非空约束</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN stuName VARCHAR(20) NOT NULL;</span><br><span class="line"></span><br><span class="line">#2、添加默认约束</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN age INT DEFAULT 18;</span><br><span class="line"></span><br><span class="line">#3、添加主键约束</span><br><span class="line"></span><br><span class="line">-- 列级约束写法</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN id INT PRIMARY KEY;</span><br><span class="line"></span><br><span class="line">-- 表级约束写法</span><br><span class="line">ALTER TABLE stuinfo ADD PRIMARY KEY(id); #这里ADD后面直接跟PRIMARY KEY不能有COLUMN</span><br><span class="line"></span><br><span class="line">#4、添加唯一约束</span><br><span class="line"></span><br><span class="line">-- 列级约束写法</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN seat INT UNIQUE;</span><br><span class="line"></span><br><span class="line">-- 表级约束写法</span><br><span class="line">ALTER TABLE stuinfo ADD UNIQUE(seat);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#5、添加外键约束</span><br><span class="line"></span><br><span class="line">-- 列级写法，语法可行，但没有实际运行改变</span><br><span class="line"></span><br><span class="line">-- 表级写法</span><br><span class="line">ALTER TABLE stuinfo ADD CONSTRAINT fk_stuinfo_major FOREIGN KEY(majorid) REFERENCES major(id);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="修改表时删除约束"><a href="#修改表时删除约束" class="headerlink" title="修改表时删除约束"></a>修改表时删除约束</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">##########</span><br><span class="line">#三、修改表时删除约束</span><br><span class="line">##########</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#1、删除非空约束</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN stuName VARCHAR(20);</span><br><span class="line"></span><br><span class="line">#2、删除默认约束</span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN age INT;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#3、删除主键</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo MODIFY COLUMN id INT;</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo DROP PRIMARY KEY;</span><br><span class="line"></span><br><span class="line">#4、删除唯一</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo DROP INDEX seat;  -- seat 是SHOW INDEX FROM stuinfo中的Key_name列中的值</span><br><span class="line"></span><br><span class="line">#5、删除外键约束</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo DROP FOREIGN KEY fk_stuinfo_major;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="标识列"><a href="#标识列" class="headerlink" title="标识列"></a>标识列</h2><p>又称为自增长列，可以不用手动的插入值，系统提供默认的序列值 </p>
<ul>
<li><p>特点</p>
<ul>
<li><p>标识列必须是一个键（主键，外键，唯一键）</p>
</li>
<li><p>一个表至多只能有一个标识列</p>
</li>
<li><p>标识列的数据类型只能是数值型（整型，小数）</p>
</li>
<li><p>标识列可以通过<code>set auto_increment_increment = 123</code>来设置步长</p>
<p>并通过手动插入首行记录来实现修改起始值的目的</p>
</li>
</ul>
</li>
</ul>
<h3 id="创建表时设置标识列"><a href="#创建表时设置标识列" class="headerlink" title="创建表时设置标识列"></a>创建表时设置标识列</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#一、创建表时设置标识列</span><br><span class="line"></span><br><span class="line">CREATE TABLE tab_identity(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT, # AUTO_INCREMENT设定自增长</span><br><span class="line">	NAME VARCHAR(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_identity </span><br><span class="line">VALUES(NULL, &#x27;john&#x27;)  -- 会自动赋值1</span><br><span class="line">,(NULL, &#x27;john&#x27;);-- 会自动赋值2</span><br><span class="line"></span><br><span class="line">INSERT INTO tab_identity(NAME) VALUES(&#x27;lucy&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#设置步长值（步长起始索引在mysql中无法更改,可以在插入第1行记录时手动设置起始索引）</span><br><span class="line"></span><br><span class="line">SHOW VARIABLES LIKE &#x27;%auto_increment%&#x27;;</span><br><span class="line"></span><br><span class="line">SET auto_increment_increment = 3;</span><br></pre></td></tr></table></figure>

<h3 id="修改表时设置-删除标识列"><a href="#修改表时设置-删除标识列" class="headerlink" title="修改表时设置&#x2F;删除标识列"></a>修改表时设置&#x2F;删除标识列</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#二、修改表时设置标识列</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS tab_identity;</span><br><span class="line">CREATE TABLE tab_identity(</span><br><span class="line">	id FLOAT,</span><br><span class="line">	NAME VARCHAR(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ALTER TABLE tab_identity MODIFY COLUMN id FLOAT UNIQUE AUTO_INCREMENT; #标识列必须是键</span><br><span class="line"></span><br><span class="line">#修改表时删除标识列</span><br><span class="line"></span><br><span class="line">ALTER TABLE tab_identity MODIFY COLUMN id FLOAT; #标识列必须是键</span><br></pre></td></tr></table></figure>

<h2 id="级联删除和级联置空"><a href="#级联删除和级联置空" class="headerlink" title="级联删除和级联置空"></a>级联删除和级联置空</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS major(</span><br><span class="line">	id INT PRIMARY KEY,</span><br><span class="line">	majorName VARCHAR(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS stuinfo(</span><br><span class="line">	id INT,</span><br><span class="line">	stuName VARCHAR(20),</span><br><span class="line">	gender CHAR(1),</span><br><span class="line">	seat INT,</span><br><span class="line">	age INT,</span><br><span class="line">	majorid INT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SHOW INDEX FROM major;</span><br><span class="line"></span><br><span class="line">SHOW INDEX FROM stuinfo;</span><br><span class="line"></span><br><span class="line">ALTER TABLE stuinfo ADD CONSTRAINT fk_stuinfo_major FOREIGN KEY(majorid) REFERENCES major(id);</span><br><span class="line"></span><br><span class="line">INSERT INTO major</span><br><span class="line">VALUES</span><br><span class="line">(1,&#x27;java&#x27;),</span><br><span class="line">(2,&#x27;h5&#x27;),</span><br><span class="line">(3,&#x27;big data&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO stuinfo</span><br><span class="line">SELECT 1,&#x27;john1&#x27;,&#x27;女&#x27;, NULL, NULL, 1 UNION ALL</span><br><span class="line">SELECT 2,&#x27;john2&#x27;,&#x27;女&#x27;, NULL, NULL, 1 UNION ALL</span><br><span class="line">SELECT 3,&#x27;john3&#x27;,&#x27;女&#x27;, NULL, NULL, 2 UNION ALL</span><br><span class="line">SELECT 4,&#x27;john4&#x27;,&#x27;女&#x27;, NULL, NULL, 2 UNION ALL</span><br><span class="line">SELECT 5,&#x27;john5&#x27;,&#x27;女&#x27;, NULL, NULL, 1 UNION ALL</span><br><span class="line">SELECT 6,&#x27;john6&#x27;,&#x27;女&#x27;, NULL, NULL, 3 UNION ALL</span><br><span class="line">SELECT 7,&#x27;john7&#x27;,&#x27;女&#x27;, NULL, NULL, 3 UNION ALL</span><br><span class="line">SELECT 8,&#x27;john8&#x27;,&#x27;女&#x27;, NULL, NULL, 1; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#删除专业表的3号专业</span><br><span class="line"></span><br><span class="line">DELETE FROM major WHERE id = 3; -- 会报错，因为有外键引用</span><br><span class="line"></span><br><span class="line">##方式一：级联删除</span><br><span class="line">#外键的设置方式需要添加关键字  on delete cascade</span><br><span class="line"></span><br><span class="line">-- 先删除存在的外键</span><br><span class="line">ALTER TABLE stuinfo DROP FOREIGN KEY fk_stuinfo_major;</span><br><span class="line"></span><br><span class="line">-- 设置可以级联删除的外键</span><br><span class="line">ALTER TABLE stuinfo ADD CONSTRAINT fk_stu_major FOREIGN KEY(majorid) REFERENCES major(id) ON DELETE CASCADE;</span><br><span class="line"></span><br><span class="line">-- 这种外键的设置，可以直接删除主表中的数据，并且从表中有引用主表被删除数据的记录也一并删除</span><br><span class="line"></span><br><span class="line">DELETE FROM major WHERE id = 3;</span><br><span class="line"></span><br><span class="line">SELECT * FROM major;</span><br><span class="line"></span><br><span class="line">SELECT * FROM stuinfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##方式二：级联置空</span><br><span class="line">#外键的设置方式需要添加关键字  on delete set null</span><br><span class="line"></span><br><span class="line">-- 先删除存在的外键</span><br><span class="line">ALTER TABLE stuinfo DROP FOREIGN KEY fk_stu_major;</span><br><span class="line"></span><br><span class="line">-- 设置可以级联删除的外键</span><br><span class="line">ALTER TABLE stuinfo ADD CONSTRAINT fk_stu_major FOREIGN KEY(majorid) REFERENCES major(id) ON DELETE SET NULL;</span><br><span class="line"></span><br><span class="line">-- 这种外键的设置，可以直接删除主表中的数据，并且从表中有引用主表被删除数据的记录对应字段被设置为NULL</span><br><span class="line"></span><br><span class="line">DELETE FROM major WHERE id = 2;</span><br><span class="line"></span><br><span class="line">SELECT * FROM major;</span><br><span class="line"></span><br><span class="line">SELECT * FROM stuinfo;</span><br></pre></td></tr></table></figure>



<h1 id="TCL语言"><a href="#TCL语言" class="headerlink" title="TCL语言"></a>TCL语言</h1><ul>
<li>TCL : Transaction control language 事务控制语言</li>
</ul>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><ul>
<li><p>定义：</p>
<p>事务由单独单元的一个或多个sql语句组成，在这个单元中，每个mysql语句是相互依赖的。而整个单独单元作为一个不可分割的整体，如果单元中某条sql语句一旦执行失败或产生错误，整个单元将会<strong>回滚</strong>。所有受到影响的数据将返回到事务开始以前的状态；如果单元中的所有sql语句均执行成功，则事务被顺利执行。</p>
</li>
<li><p>场景：如转账，两个账号转出和转入要么都能成功，要么都不成功，不能只转出成功，转入不成功</p>
</li>
<li><p>存储引擎</p>
<ul>
<li>概念：在mysql中的数据用各种不同的技术存储在文件（或内存）中</li>
<li>通过<code>show engines</code>：来查看mysql支持的存储引擎，默认是innodb</li>
<li>在mysql中用的最多的存储引擎有：innodb, myisam, memory等。其中innodb支持事务，而myisam, memory等不支持事务</li>
</ul>
</li>
</ul>
<h2 id="star2-事务的ACID（acid）特性"><a href="#star2-事务的ACID（acid）特性" class="headerlink" title=":star2: 事务的ACID（acid）特性"></a>:star2: 事务的<strong>ACID</strong>（acid）特性</h2><ul>
<li><p><strong>原子性</strong>(<em>Atomicity</em>)</p>
<p>原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</p>
</li>
<li><p><strong>一致性</strong>(<em>Consistency</em>)</p>
<p>事务必须使数据库从一个一致性状态变换到另一个一致性状态</p>
<p>如：对于银行账户余额的库，如只允许转账操作，那么完成一个转账事务后，总的金额数会和事务前总的金额数一样</p>
</li>
<li><p><strong>隔离性</strong>(<em>Isolation</em>)</p>
<p>事务的隔离性是指一个事务的执行不能被其它事务干扰，即一个事务内部的操作及使用的数据对并发的其它事务是隔离的，并发执行的各个事务之间不能互相干扰（需要受设置的隔离级别影响）</p>
</li>
<li><p><strong>持久性</strong>(<em>Durability</em>)</p>
<p>持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其它操作和数据库故障不应该对其有任何影响</p>
</li>
</ul>
<h2 id="事务的创建"><a href="#事务的创建" class="headerlink" title="事务的创建"></a>事务的创建</h2><ul>
<li><p>隐式事务：事务没有明显的开启和结束的标记</p>
<ul>
<li>任意一个insert&#x2F;update&#x2F;delete语句都会被当作一个事务</li>
<li><code>SHOW VARIABLES LIKE &#39;%autocommit%&#39;;</code> 可以查看自动提交事务是否是开启的</li>
</ul>
</li>
<li><p>显示事务：事务具有明显的开启和结束的标记</p>
<ul>
<li><p>前提：必须先设置自动提交功能为禁用<code>set autocommit = 0;</code>，需要注意禁用自动提交只对当前对话（查询 ）有效</p>
</li>
<li><p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#步骤1：开启事务</span><br><span class="line">SET autocommit = 0;</span><br><span class="line">START TRANSACTION; -- 可选</span><br><span class="line"></span><br><span class="line">#步骤2：编写事务中的sql语句(select insert update delete 查、增、改、删)</span><br><span class="line">语句1;</span><br><span class="line">语句2;</span><br><span class="line">语句3;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">#步骤3：结束事务（要么是commit，要么是rollback，在服务器端无法根据是否成功来由程序自己选择）</span><br><span class="line">COMMIT; -- 提交事务</span><br><span class="line">ROLLBACK; -- 回滚事务</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>演示事务的使用步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#演示事务的使用步骤</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS account;</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS account(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	username VARCHAR(20),</span><br><span class="line">	balance DOUBLE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO account(username, balance)</span><br><span class="line">VALUES(&#x27;张无忌&#x27;,1000), (&#x27;赵敏&#x27;,1000);</span><br><span class="line"></span><br><span class="line">## 开启事务</span><br><span class="line">SET autocommit = 0;</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">## 编写一组事务的语句</span><br><span class="line">UPDATE account SET balance = 500 WHERE username = &#x27;张无忌&#x27;;</span><br><span class="line">UPDATE account SET balance = 1500 WHERE username = &#x27;赵敏&#x27;;</span><br><span class="line"></span><br><span class="line">## 结束事务</span><br><span class="line">COMMIT;</span><br><span class="line">ROLLBACK;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">在有commit或者rollback前，事务的处理相当于只是暂时存储在内存中，并没有更改数据库中的</span><br><span class="line">具体数据，当遇到commit时，事务具体发生，更改数据，当遇到rollback时，相当于事务的处理</span><br><span class="line">从内存中删除，没有具体对数据库的数据操作。</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#演示事务对delete和truncate的处理的区别</span><br><span class="line"></span><br><span class="line">SET autocommit = 0;</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">DELETE FROM account;</span><br><span class="line"></span><br><span class="line">ROLLBACK; -- 顺利回滚</span><br><span class="line"></span><br><span class="line">SET autocommit = 0;</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">TRUNCATE TABLE account;</span><br><span class="line"></span><br><span class="line">ROLLBACK; -- 无法回滚</span><br><span class="line"></span><br><span class="line">#演示savepoint的使用</span><br><span class="line"></span><br><span class="line">SET autocommit = 0;</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">DELETE FROM account WHERE id = 1;</span><br><span class="line">SAVEPOINT a; #设置保存点</span><br><span class="line">DELETE FROM account WHERE id = 2;</span><br><span class="line"></span><br><span class="line">ROLLBACK TO a;#回滚到保存点</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="数据库的隔离级别"><a href="#数据库的隔离级别" class="headerlink" title="数据库的隔离级别"></a>数据库的隔离级别</h2><ul>
<li><p>对于同时运行的多个事务，当这些事务访问<strong>数据库中相同的数据</strong>时，如果没有采取必要的隔离机制，就会导致各种并发问题：</p>
<ul>
<li><p><strong>脏读</strong></p>
<p>对于两个事务T1，T2，T1读取了已经被T2<strong>更新但还没有被提交</strong>的字段，之后，若T2回滚，T1读取的内容就是临时且无效的</p>
</li>
<li><p><strong>不可重复读</strong></p>
<p>对于两个事务T1，T2，T1读取了一个字段，然后T2<strong>更新</strong>了该字段，之后， T1再次读取同一个字段，值就不同了</p>
</li>
<li><p><strong>幻读</strong></p>
<p>对于两个事务T1，T2，T1读取了一个字段，然后T2在该表中<strong>插入</strong>了一些新的行。之后 ，如果T1再次读取同一个表，就会多出几行</p>
</li>
</ul>
</li>
<li><p>数据库事务的隔离性：数据库系统必须具有隔离并发运行各个事务的能力，使它们不会相互影响，避免各种并发问题</p>
</li>
<li><p>一个事务与其他事务隔离的程度称为隔离级别，数据库规定了多种事务隔离级别，不同隔离级别对应不同的干扰程度，隔离级别越高，数据一致性就越好，但并发性越弱</p>
</li>
<li><p>数据库提供的4种事务隔离级别</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>READ UNCOMMITTED</code>(读未提交数据)</td>
<td>允许事务读取未被其他事务提交的变更，脏读、不可重复读和幻读的问题都会出现</td>
</tr>
<tr>
<td><code>READ COMMITTED</code>(读已提交数据)</td>
<td>只允许事务读取已经被其他事务提交的变更，可以避免脏读，但不可重复读和幻读问题仍然可能出现</td>
</tr>
<tr>
<td><code>REPEATABLE READ</code>(可重复读)</td>
<td>确保事务可以多次从一个字段中读取相同的值，在这个事务持续期间，禁止其他事务对这个字段进行更新，可以避免脏读和不可重复读，但幻读的问题仍然存在</td>
</tr>
<tr>
<td><code>SERIALIZABLE</code>(串行化)</td>
<td>确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其他事务对该表执行插入，更新和删除操作，所有并发问题都可以避免，但性能十分低下</td>
</tr>
</tbody></table>
</li>
<li><p>oracle支持的2种事务隔离级别：<code>READ COMMITED</code>，<code>SERIALIZABLE</code>，默认的是<code>READ COMMITED</code></p>
</li>
<li><p>mysql支持4种事务隔离级别，默认的是<code>REPEATABLE READ</code></p>
</li>
<li><p>每启动一个mysql程序，就会获得一个单独的数据库连接，每个数据库连接都有一个全局变量<code>@@tx_isolation</code>，表示当前的事务隔离级别</p>
</li>
<li><p>查看当前的隔离级别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@tx_isolation;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置当前mysql连接的隔离级别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set session transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置数据库系统的全局的隔离级别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level read committed;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="视图-1"><a href="#视图-1" class="headerlink" title="视图"></a>视图</h2><ul>
<li><p>含义：虚拟表，和普通表一样使用。行和列的数据来自定义视图的查询中使用的表，并且是在使用时动态生成的，只保存了sql逻辑，不保存查询结果（相当于对一段可以查询出表的语句段进行封装）</p>
</li>
<li><p>应用场景：</p>
<ul>
<li>多个地方用到同样的查询结果 </li>
<li>该查询结果使用的sql语句较复杂</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#案例：查询姓张的学生名和专业名</span><br><span class="line"></span><br><span class="line">CREATE VIEW v1</span><br><span class="line">AS</span><br><span class="line">SELECT stuname, majorname</span><br><span class="line">FROM stuinfo s</span><br><span class="line">INNER JOIN major m</span><br><span class="line">ON s.majorid = m.id;</span><br><span class="line"></span><br><span class="line">SELECT * FROM v1 WHERE stuname LIKE &#x27;张%&#x27;;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>创建视图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#一、创建视图</span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line">create view 视图名</span><br><span class="line">as</span><br><span class="line">查询语句;</span><br><span class="line">*/</span><br><span class="line">USE myemployees;</span><br><span class="line"></span><br><span class="line">#案例1：查询姓名中包含a字符的员工名、部门名和工种信息</span><br><span class="line"></span><br><span class="line">-- 创建视图</span><br><span class="line">CREATE VIEW myv1</span><br><span class="line">AS</span><br><span class="line">SELECT last_name, department_name, job_title</span><br><span class="line">FROM employees e</span><br><span class="line">INNER JOIN departments d ON e.department_id = d.department_id</span><br><span class="line">INNER JOIN jobs j ON j.job_id = e.job_id;</span><br><span class="line"></span><br><span class="line">-- 使用视图</span><br><span class="line">SELECT * FROM myv1 WHERE last_name LIKE &#x27;%a%&#x27;;</span><br><span class="line"></span><br><span class="line">#案例2：查询各部门的平均工资级别</span><br><span class="line"></span><br><span class="line">-- 创建视图</span><br><span class="line">CREATE VIEW myv2</span><br><span class="line">AS</span><br><span class="line">SELECT AVG(salary) ag, department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id;</span><br><span class="line"></span><br><span class="line">-- 查询级别</span><br><span class="line">SELECT myv2.ag, g.grade_level</span><br><span class="line">FROM myv2</span><br><span class="line">INNER JOIN job_grades g</span><br><span class="line">ON myv2.ag BETWEEN g.`lowest_sal` AND g.`highest_sal`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例3：查询平均工资最低的部门信息</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv2 ORDER BY ag LIMIT 1;</span><br><span class="line"></span><br><span class="line">#案例4：查询平均工资最低的部门名和工资</span><br><span class="line"></span><br><span class="line">CREATE VIEW myv3</span><br><span class="line">AS</span><br><span class="line">SELECT * FROM myv2 ORDER BY ag LIMIT 1;</span><br><span class="line"></span><br><span class="line">SELECT d.*, m.ag</span><br><span class="line">FROM myv3 m</span><br><span class="line">INNER JOIN departments d</span><br><span class="line">ON m.`department_id` = d.`department_id`;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>视图的修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#二、修改视图</span><br><span class="line">#方式一：</span><br><span class="line">/*</span><br><span class="line">create or replace view 视图名</span><br><span class="line">as</span><br><span class="line">查询语句;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#案例：将myv3视图更改为不同工种的平均工资</span><br><span class="line">CREATE OR REPLACE VIEW myv3</span><br><span class="line">AS </span><br><span class="line">SELECT AVG(salary), job_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY job_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#方式二：</span><br><span class="line">/*</span><br><span class="line">alter view 视图名</span><br><span class="line">as</span><br><span class="line">查询语句;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">ALTER VIEW myv3</span><br><span class="line">AS </span><br><span class="line">SELECT * FROM employees;</span><br></pre></td></tr></table></figure>

<h2 id="视图的查看和删除"><a href="#视图的查看和删除" class="headerlink" title="视图的查看和删除"></a>视图的查看和删除</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#三、视图的查看和修改</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">语法：</span><br><span class="line">drop view 视图名1，视图名2,....;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">DROP VIEW myv1, myv2, myv3;</span><br><span class="line"></span><br><span class="line">#四、查看视图</span><br><span class="line"></span><br><span class="line">CREATE VIEW myv3</span><br><span class="line">AS </span><br><span class="line">SELECT * FROM employees;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看视图</span><br><span class="line">DESC myv3;</span><br><span class="line"></span><br><span class="line">show create view 视图名;</span><br></pre></td></tr></table></figure>

<h2 id="视图的更新"><a href="#视图的更新" class="headerlink" title="视图的更新"></a>视图的更新</h2><ul>
<li>视图保存的是sql语句的逻辑，是原表数据经过查询后的映射，对视图的更新实际上是对原表的更改，然后因为是对原表的映射，最终好像是实现了对视图的更新修改</li>
<li>以下类型的视图是不能更新的<ul>
<li>包含以下关键字的sql语句：分组函数，distinct，group by， having，union，union all</li>
<li>常量视图</li>
<li>select中包含子查询</li>
<li>join</li>
<li>from一个不能更新的视图</li>
<li>where子名的子查询引用了from子句中的表</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">#五、视图的更新</span><br><span class="line"></span><br><span class="line">CREATE OR REPLACE VIEW myv1</span><br><span class="line">AS </span><br><span class="line">SELECT last_name, email</span><br><span class="line">FROM employees;</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv1;</span><br><span class="line"></span><br><span class="line">#1、插入</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO myv1 VALUES (&#x27;张飞2&#x27;,&#x27;zf@qq.com&#x27;);</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv1; -- 新记录在myv1视图中</span><br><span class="line"></span><br><span class="line">SELECT * FROM employees; -- 新记录也在原表中存在，除last_name和email外其余为null</span><br><span class="line">/*由于employees表的employee_id是主键和标识列，可以自己赋值，若不是自增长列那么新记录是无法</span><br><span class="line">插入到视图中的，因为在employees表中这条记录也无法插入</span><br><span class="line">注意：视图中的字段皆是原表中有的字段，如果视图中有原表中没有的字段如年薪，则无法插入包含年薪的新记录</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#2、修改</span><br><span class="line"></span><br><span class="line">UPDATE myv1 SET last_name = &#x27;张无忌&#x27; WHERE last_name = &#x27;张飞&#x27;;</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv1;</span><br><span class="line"></span><br><span class="line">SELECT * FROM employees;</span><br><span class="line"></span><br><span class="line">#3、删除</span><br><span class="line"></span><br><span class="line">DELETE FROM myv1 WHERE last_name = &#x27;张无忌&#x27;;  -- 视图和原表都删除了</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv1;</span><br><span class="line"></span><br><span class="line">SELECT * FROM employees;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##以下类型的视图是不能更新的</span><br><span class="line"></span><br><span class="line">#1、 包含以下关键字的sql语句：分组函数，distinct，group by， having，union，union all</span><br><span class="line">DROP VIEW IF EXISTS myv1;</span><br><span class="line"></span><br><span class="line">CREATE OR REPLACE VIEW myv1</span><br><span class="line">AS</span><br><span class="line">SELECT MAX(salary) m, department_id</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id;</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv1;</span><br><span class="line"></span><br><span class="line">#更新</span><br><span class="line"></span><br><span class="line">UPDATE myv1 SET m = 9000 WHERE department_id = 10; -- 更新失败</span><br><span class="line"></span><br><span class="line">#2、 常量视图</span><br><span class="line"></span><br><span class="line">CREATE OR REPLACE VIEW myv2</span><br><span class="line">AS </span><br><span class="line">SELECT &#x27;john&#x27; NAME;</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv2;</span><br><span class="line"></span><br><span class="line">#更新</span><br><span class="line">UPDATE myv2 SET NAME = &#x27;lucy&#x27;;  -- 更新失败</span><br><span class="line"></span><br><span class="line">#3、 select中包含子查询</span><br><span class="line"></span><br><span class="line">CREATE OR REPLACE VIEW myv3</span><br><span class="line">AS </span><br><span class="line">SELECT (SELECT MAX(salary) FROM employees) 最高工资;</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv3;</span><br><span class="line"></span><br><span class="line">#更新</span><br><span class="line"></span><br><span class="line">UPDATE myv3 SET 最高工资= 10000; -- 更新失败</span><br><span class="line"></span><br><span class="line">#4、 join</span><br><span class="line">CREATE OR REPLACE VIEW myv4</span><br><span class="line">AS</span><br><span class="line">SELECT last_name, department_name</span><br><span class="line">FROM employees AS e</span><br><span class="line">JOIN departments AS d</span><br><span class="line">ON e.department_id = d.department_id;</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv4;</span><br><span class="line"></span><br><span class="line">#更新</span><br><span class="line">UPDATE myv4 SET last_name = &#x27;张飞&#x27; WHERE last_name = &#x27;Whalen&#x27;; -- 修改可以成功</span><br><span class="line"></span><br><span class="line">INSERT INTO myv4 VALUES(&#x27;陈真&#x27;,&#x27;xxxx&#x27;); -- 无法插入新值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#5、from一个不能更新的视图</span><br><span class="line">CREATE OR REPLACE VIEW myv5</span><br><span class="line">AS</span><br><span class="line">SELECT * FROM myv3;</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv5;</span><br><span class="line"></span><br><span class="line">#更新</span><br><span class="line">UPDATE myv5 SET 最高工资= 100000; -- 更新失败</span><br><span class="line"></span><br><span class="line">#6、 where子句的子查询引用了from子句中的表</span><br><span class="line"></span><br><span class="line">CREATE OR REPLACE VIEW myv6</span><br><span class="line">AS</span><br><span class="line">SELECT last_name, email, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE employee_id IN (</span><br><span class="line">	SELECT manager_id</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE manager_id IS NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">SELECT * FROM myv6;</span><br><span class="line">#更新</span><br><span class="line">UPDATE myv6 SET salary = 10000 WHERE last_name = &#x27;K_ing&#x27;; -- 更新失败</span><br></pre></td></tr></table></figure>

<h2 id="视图和表的对比"><a href="#视图和表的对比" class="headerlink" title="视图和表的对比"></a>视图和表的对比</h2><table>
<thead>
<tr>
<th></th>
<th>创建语法的关键字</th>
<th>是否实际占用物理空间</th>
<th>使用</th>
</tr>
</thead>
<tbody><tr>
<td>视图</td>
<td>create view</td>
<td>没有为数据占用空间，只是占用了保存sql逻辑需要的空间</td>
<td>增、删、改，一般不能用；通常只用来查</td>
</tr>
<tr>
<td>表</td>
<td>creae table</td>
<td>有为数据占用空间</td>
<td>增、删、改、查</td>
</tr>
</tbody></table>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><ul>
<li>分类<ul>
<li>系统变量<ul>
<li>全局变量</li>
<li>会话变量</li>
</ul>
</li>
<li>自定义变量<ul>
<li>用户变量</li>
<li>局部变量</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h2><ul>
<li><p>变量由系统提供，不是用户定义的，属于服务器层面</p>
</li>
<li><p>语法</p>
<ul>
<li><p>查看所有的系统变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#显示所有系统变量</span><br><span class="line">show variables;</span><br><span class="line"></span><br><span class="line">#显示全局变量</span><br><span class="line">show global variables;</span><br><span class="line"></span><br><span class="line">#显示会话变量</span><br><span class="line">show session variables;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看满足条件的部分系统变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global|[session] variables like &#x27;%char%&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看指定的某个系统变量的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 会话变量</span><br><span class="line">select @@系统变量名; </span><br><span class="line">select @@session.系统变量名;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select @@global.系统变量名; -- 全局变量</span><br></pre></td></tr></table></figure>
</li>
<li><p>为某个系统变量赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#方式一</span><br><span class="line">set global|[session] 系统变量名 = 值;</span><br><span class="line"></span><br><span class="line">#方式二</span><br><span class="line">set @@global|[session].系统变量名 = 值;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果是全局级别，则需要加global，如果是会话级别，则需要加session，如果不写，则默认是session</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#一、全局变量</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">作用域：</span><br><span class="line">	服务器每次启动将为所有的全局变量赋初始值，</span><br><span class="line">	针对于所有的会话（连接）有效，但不能跨重启（即即使修改了全局变量的值，在下一次服务器重启后，</span><br><span class="line">	变量的值会自动回到系统默认的值）</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">##1、查看所有的全局变量</span><br><span class="line"></span><br><span class="line">SHOW GLOBAL VARIABLES;</span><br><span class="line"></span><br><span class="line">##2、查看部分的全局变量</span><br><span class="line"></span><br><span class="line">SHOW GLOBAL VARIABLES LIKE &#x27;%char%&#x27;;</span><br><span class="line"></span><br><span class="line">##3、查看指定的全局变量的值</span><br><span class="line"></span><br><span class="line">SELECT @@global.autocommit;</span><br><span class="line"></span><br><span class="line">SELECT @@gloabl.tx_isolation;</span><br><span class="line"></span><br><span class="line">##4、为某个指定的全局变量赋值</span><br><span class="line"></span><br><span class="line">-- 方式一；</span><br><span class="line">SET @@global.autocommit = 0;</span><br><span class="line"></span><br><span class="line">-- 方式二：</span><br><span class="line">SET GLOBAL autocommit = 1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#二、会话变量</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">作用域：</span><br><span class="line">	仅仅针对于当前会话（连接）有效</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#1、查看所有的会话变量</span><br><span class="line"></span><br><span class="line">SHOW VARIABLES;</span><br><span class="line">SHOW SESSION VARIABLES;</span><br><span class="line"></span><br><span class="line">#2、查看部分的会话变量</span><br><span class="line"></span><br><span class="line">SHOW VARIABLES LIKE &#x27;%char%&#x27;;</span><br><span class="line">SHOW SESSION VARIABLES LIKE &#x27;%char%&#x27;;</span><br><span class="line"></span><br><span class="line">#3、查看指定的某个会话变量</span><br><span class="line"></span><br><span class="line">SELECT @@tx_isolation;</span><br><span class="line">SELECT @@session.tx_isolation;</span><br><span class="line"></span><br><span class="line">#4、为某个会话变量赋值</span><br><span class="line"></span><br><span class="line">-- 方式一：</span><br><span class="line">SET @@session.tx_isolation = &#x27;read-uncommitted&#x27;;</span><br><span class="line">SET @@tx_isolation = &#x27;read-uncommitted&#x27;;</span><br><span class="line"></span><br><span class="line">-- 方式二：</span><br><span class="line">SET SESSION tx_isolation = &#x27;read-committed&#x27;;</span><br></pre></td></tr></table></figure>



<h2 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h2><ul>
<li><p>变量是用户定义的，不是由系统提供的</p>
</li>
<li><p>使用步骤：</p>
<ul>
<li>声明</li>
<li>赋值</li>
<li>使用<ul>
<li>查看</li>
<li>比较</li>
<li>运算</li>
<li>…</li>
</ul>
</li>
</ul>
</li>
<li><p>分类</p>
<ul>
<li><p>用户变量</p>
<ul>
<li>作用域：针对于当前会话（连接）有效，同于会话变量的作用域</li>
<li>应用在任何地方，也就是begin end里面或外面</li>
</ul>
</li>
<li><p>局部变量</p>
<ul>
<li>作用域：仅仅在定义它的begin end中有效</li>
<li>应用在begin end中的第一名话</li>
</ul>
</li>
<li><p>对比</p>
<table>
<thead>
<tr>
<th></th>
<th>作用域</th>
<th>定义和使用的位置</th>
<th>语法</th>
</tr>
</thead>
<tbody><tr>
<td>用户变量</td>
<td>当前的会话</td>
<td>会话中的任何地方</td>
<td>必须加@符号，不用限定类型</td>
</tr>
<tr>
<td>局部变量</td>
<td>begin end中</td>
<td>只能在begin end中，且为第一句话</td>
<td>一般不用加@符号，需要限定类型</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">#1、用户变量</span><br><span class="line">/*</span><br><span class="line">作用域：针对于当前会话（连接）有效，同于会话变量的作用域</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">##1.声明并初始化</span><br><span class="line"></span><br><span class="line">赋值的操作符   =或 :=</span><br><span class="line"></span><br><span class="line">-- 以下是三种写法</span><br><span class="line">SET @用户变量名 = 值;</span><br><span class="line">SET @用户变量名 := 值;</span><br><span class="line">SELECT @用户变量名 := 值;</span><br><span class="line"></span><br><span class="line">#案例：声明并初始化</span><br><span class="line">SET @name = &#x27;john&#x27;;</span><br><span class="line">SET @name = 100;</span><br><span class="line">SET @cnt = 1;</span><br><span class="line"></span><br><span class="line">##2.赋值（更新用户变量的值）</span><br><span class="line"></span><br><span class="line">方式一：通过 SET 或 SELECT </span><br><span class="line">SET @用户变量名 = 值;</span><br><span class="line">SET @用户变量名 := 值;</span><br><span class="line">SELECT @用户变量名 := 值;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二：通过 SELECT INTO</span><br><span class="line">SELECT 字段 INTO @变量名</span><br><span class="line">FROM 表名;  -- 相当于一个查询语句的结果赋值给这个变量，但查询结果需要是标量</span><br><span class="line"></span><br><span class="line">#案例：赋值</span><br><span class="line">SELECT COUNT(*) INTO @cnt</span><br><span class="line">FROM employees;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##3.使用（查看用户变量的值）</span><br><span class="line"></span><br><span class="line">SELECT @用户变量名</span><br><span class="line"></span><br><span class="line">#案例：查看</span><br><span class="line">SELECT @cnt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2、局部变量</span><br><span class="line">/*</span><br><span class="line">作用域：仅仅在定义它的begin end中有效</span><br><span class="line">应用在begin end中的第一句话</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">##1.声明</span><br><span class="line"></span><br><span class="line">DECLARE 变量名 类型; -- 仅声明，没有初始化</span><br><span class="line">DECLARE 变量名 类型 DEFAULT 值; -- 声明的时候同时初始化</span><br><span class="line"></span><br><span class="line">##2.赋值</span><br><span class="line"></span><br><span class="line">方式一：通过 SET 或 SELECT </span><br><span class="line">SET 局部变量名 = 值;</span><br><span class="line">SET 局部变量名 := 值;</span><br><span class="line">SELECT @局部变量名 := 值;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二：通过 SELECT INTO</span><br><span class="line">SELECT 字段 INTO 局部变量名</span><br><span class="line">FROM 名;</span><br><span class="line"></span><br><span class="line">##3.使用</span><br><span class="line">SELECT 局部变量名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例：声明两个变量并赋初始值，求和，并打印</span><br><span class="line"></span><br><span class="line">#1.用户变量</span><br><span class="line">SET @m = 1;</span><br><span class="line">SET @n = 2;</span><br><span class="line">SET @sum = @m + @n;</span><br><span class="line">SELECT @sum;</span><br><span class="line"></span><br><span class="line">#2.局部变量</span><br><span class="line"></span><br><span class="line">-- 下面因为没有在begin end中使用，会语法报错</span><br><span class="line">DECLARE m INT DEFAULT 1;</span><br><span class="line">DECLARE n INT DEFAULT 2;</span><br><span class="line">DECLARE SUM INT;</span><br><span class="line">SET SUM = m + n;</span><br><span class="line">SELECT SUM;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h1><ul>
<li>存储过程和函数：类似于java中的方法<ul>
<li>好处<ul>
<li>提高代码的重用性</li>
<li>简化操作</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><ul>
<li>含义：一组预先编译好的sql语句的集合，理解成批处理语句</li>
<li>好处<ul>
<li>提高代码的重用性</li>
<li>简化操作</li>
<li>减少了编译次数，并且减少了和数据库服务器的连接次数，提高了效率</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">#一、创建语法</span><br><span class="line"></span><br><span class="line">-- 语法：</span><br><span class="line">CREATE PROCEDURE 存储过程名(参数列表)</span><br><span class="line">BEGIN</span><br><span class="line">	存储过程体</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">1、参数列表包含三部分</span><br><span class="line">   参数的模式	参数名	参数类型</span><br><span class="line">举例：</span><br><span class="line">IN stuname VARCHAR(20)</span><br><span class="line"></span><br><span class="line">参数模型：</span><br><span class="line">IN：该参数可以作为输入，也就是说该参数需要调用方传入值</span><br><span class="line">OUT：该参数可以作为输出，也就是说该参数可以作为返回值</span><br><span class="line">INOUT：该参数既可以作为输入，也可以作为输出，也就是说该参数既需要传入值，又可以返回值</span><br><span class="line"></span><br><span class="line">2、如果存储过程体仅仅只有一句话，BEGIN END 可以省略</span><br><span class="line">   存储过程体中的每条SQL语句的结尾要求必须加分号</span><br><span class="line">   存储过程的结尾可以使用 DELIMITER 重新设置</span><br><span class="line">   语法：</span><br><span class="line">     DELIMITER 结束标记 -- 一旦设置完成后，后面的语法都要以这个符号为结束标记了</span><br><span class="line">   如：</span><br><span class="line">     DELIMITER $</span><br><span class="line"></span><br><span class="line">#二、调用语法</span><br><span class="line"></span><br><span class="line">语法:</span><br><span class="line">  CALL 存储过程名(实参列表) 结束标记</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"> ##########  创建和调用 ##################</span><br><span class="line">  </span><br><span class="line">#1.空参列表</span><br><span class="line"></span><br><span class="line">##案例：插入到admin表中五条记录</span><br><span class="line">SELECT * FROM admin;</span><br><span class="line"></span><br><span class="line">#以下都要去命令行，即sql服务器中运行</span><br><span class="line">-- 先设置结束标记符</span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE myp1()</span><br><span class="line">BEGIN</span><br><span class="line">	INSERT INTO admin(username, `password`)</span><br><span class="line">	VALUES(&#x27;john1&#x27;,&#x27;0000&#x27;)</span><br><span class="line">	,(&#x27;lily&#x27;,&#x27;0000&#x27;)</span><br><span class="line">	,(&#x27;rose&#x27;,&#x27;0000&#x27;)</span><br><span class="line">	,(&#x27;jack&#x27;,&#x27;0000&#x27;)</span><br><span class="line">	,(&#x27;tom&#x27;,&#x27;0000&#x27;);</span><br><span class="line">END $ -- 最开始设置的结束标记符</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">CALL myp1()$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2、创建带in模式参数的存储过程</span><br><span class="line"></span><br><span class="line">#案例1：创建存储过程实现，根据女神名，查询对应的男神信息</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE myp2(IN beautyName VARCHAR(20))</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT bo.*</span><br><span class="line">	FROM boys bo</span><br><span class="line">	RIGHT JOIN beauty b ON bo.id = b.boyfriend_id</span><br><span class="line">	WHERE b.name = beautyName;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">CALL myp2(&#x27;柳岩&#x27;)$</span><br><span class="line"></span><br><span class="line">-- 如果有遇上字符问题，可以执行下面的命令</span><br><span class="line">SET NAMES gbk$ -- $是因为更改过结束标记符</span><br><span class="line"></span><br><span class="line">#案例2：创建存储过程实现，用户是否登录成功</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE myp3(IN username VARCHAR(20), IN PASSWORD VARCHAR(20))</span><br><span class="line">BEGIN </span><br><span class="line">	DECLARE result VARCHAR(20) DEFAULT &#x27;&#x27;;  #声明并初始化局部变量</span><br><span class="line">	</span><br><span class="line">	SELECT IF(COUNT(*)=0,&#x27;登录失败&#x27;,&#x27;登录成功&#x27;) INTO result  #局部变量赋值</span><br><span class="line">	FROM admin</span><br><span class="line">	WHERE admin.`username` = username</span><br><span class="line">	AND admin.`password` = PASSWORD;</span><br><span class="line">	</span><br><span class="line">	SELECT result; #局部变量使用</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">CALL myp3(&#x27;张飞&#x27;,&#x27;8888&#x27;)$</span><br><span class="line"></span><br><span class="line">#3、创建带out模式的存储过程</span><br><span class="line"></span><br><span class="line">#案例1：根据女神名，返回对应的男神名</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE myp5(IN beautyName VARCHAR(20), OUT boyName VARCHAR(20))</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT bo.boyName INTO boyName</span><br><span class="line">	FROM boys bo</span><br><span class="line">	INNER JOIN beauty b ON bo.id = b.boyfriend_id</span><br><span class="line">	WHERE b.name = beautyName;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">CALL myp5(&#x27;王语嫣&#x27;,@bName)$</span><br><span class="line"></span><br><span class="line">SELECT @bName$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例2【两个out】：根据女神名，返回对应男神名和男神魅力值</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE myp6(IN beautyName VARCHAR(20), OUT boyName VARCHAR(20), OUT userCP INT)</span><br><span class="line">BEGIN</span><br><span class="line">	SELECT bo.boyName, bo.userCP INTO boyName,userCP</span><br><span class="line">	FROM boys bo</span><br><span class="line">	INNER JOIN beauty b ON bo.id = b.boyfriend_id</span><br><span class="line">	WHERE b.name = beautyName;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">CALL myp6(&#x27;岳灵珊&#x27;,@bName, @usercp)$</span><br><span class="line"></span><br><span class="line">SELECT @bName,@usercp$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#4、创建带inout模式参数的存储过程</span><br><span class="line"></span><br><span class="line">#案例1：传入a,b，将a,b翻倍后返回</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE myp8(INOUT a INT, INOUT b INT)</span><br><span class="line">BEGIN</span><br><span class="line">	SET a = a*2;</span><br><span class="line">	SET b = b*2;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">SET @m = 10$</span><br><span class="line">SET @n = 20$</span><br><span class="line">CALL myp8(@m, @n)$</span><br><span class="line">SELECT @m, @n$</span><br><span class="line"></span><br><span class="line">##################################################################################</span><br><span class="line"></span><br><span class="line">#三、删除存储过程</span><br><span class="line">语法：</span><br><span class="line">DROP PROCEDURE 存储过程名 -- 一次只能删除一个</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE myp1;</span><br><span class="line"></span><br><span class="line">DROP PROCEDURE myp2, myp3; #报错</span><br><span class="line"></span><br><span class="line">##################################################################################</span><br><span class="line">#四、查看存储过程的信息/结构 </span><br><span class="line"></span><br><span class="line">DESC myp6;#报错，这种方法不行</span><br><span class="line"></span><br><span class="line">SHOW CREATE PROCEDURE myp6; #可行</span><br></pre></td></tr></table></figure>



<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul>
<li>含义：一组预先编译好的sql语句的集合，理解成批处理语句</li>
<li>好处<ul>
<li>提高代码的重用性</li>
<li>简化操作</li>
<li>减少了编译次数，并且减少了和数据库服务器的连接次数，提高了效率</li>
</ul>
</li>
<li>与存储过程的区别<ul>
<li>存储过程：可以有0个返回，也可有多个返回， 适合做批量的插入、批量的更新</li>
<li>函数：有且仅有1个返回，适合做处理数据后返回一个结果</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">#一、创建语法</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION 函数名(参数列表) RETURNS 返回类型</span><br><span class="line">BEGIN</span><br><span class="line">	函数体</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">注意：</span><br><span class="line">1.</span><br><span class="line">参数列表包含两个部分: 参数名 参数类型</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">函数体：</span><br><span class="line">必须要有return 语句，如果没有会报错</span><br><span class="line">如果return没有放在函数体最后，这样不会报错，但不建议</span><br><span class="line">...</span><br><span class="line">return 值;</span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">当函数体中只有一句话时，begin end可以省略</span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">使用delimiter语句设置结束标记</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#二、调用语法</span><br><span class="line"></span><br><span class="line">SELECT 函数名(参数列表)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###-------###创建和调用演示###-------------###</span><br><span class="line"></span><br><span class="line">#1、无参数，有返回</span><br><span class="line">#案例：返回公司的加工个数</span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION myf1() RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE c INT DEFAULT 0; #定义变量</span><br><span class="line">	SELECT COUNT(*) INTO c #赋值</span><br><span class="line">	FROM employees;</span><br><span class="line">	</span><br><span class="line">	RETURN c;</span><br><span class="line">END$</span><br><span class="line"></span><br><span class="line">SELECT myf1()$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2、有参，有返回</span><br><span class="line">#案例1：根据员工名，返回他的工资</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION myf2(empname VARCHAR(20)) RETURNS DOUBLE</span><br><span class="line">BEGIN</span><br><span class="line">	SET @sal = 0;#定义一个用户变量</span><br><span class="line">	SELECT salary INTO @sal</span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE last_name = empname;</span><br><span class="line">	RETURN @sal;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">SELECT myf2(&#x27;kochhar&#x27;)$</span><br><span class="line"></span><br><span class="line">#案例2：根据部门名，返回该部门的平均工资</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION myf3(deptname VARCHAR(20)) RETURNS DOUBLE</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE sal DOUBLE;</span><br><span class="line">	SELECT AVG(salary) INTO sal</span><br><span class="line">	FROM employees e</span><br><span class="line">	INNER JOIN departments d</span><br><span class="line">	ON e.department_id = d.department_id</span><br><span class="line">	WHERE d.department_name = deptname;</span><br><span class="line">	</span><br><span class="line">	RETURN sal;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">SELECT myf3(&#x27;IT&#x27;)$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#------------------------#</span><br><span class="line"></span><br><span class="line">#三、查看函数</span><br><span class="line"></span><br><span class="line">SHOW CREATE FUNCTION 函数名;</span><br><span class="line"></span><br><span class="line">SHOW CREATE FUNCTION myf3;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#四、删除函数</span><br><span class="line"></span><br><span class="line">DROP FUNCTION 函数名;</span><br><span class="line"></span><br><span class="line">DROP FUNCTION myf3;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT * FROM departments;</span><br></pre></td></tr></table></figure>



<h1 id="流程控制结构"><a href="#流程控制结构" class="headerlink" title="流程控制结构"></a>流程控制结构</h1><ul>
<li>分类<ul>
<li>顺序结构：程序从上往下依次执行</li>
<li>分支结构：程序从两条或多条路径中选择一条执行</li>
<li>循环结构：程序在满足一定条件的基础上，重复执行一段代码</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line">#一、分支结构 </span><br><span class="line">#1、if函数</span><br><span class="line"></span><br><span class="line">功能：实现简单的分支</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">SELECT IF(表达式1,表达式2,表达式3);</span><br><span class="line"></span><br><span class="line">执行顺序：</span><br><span class="line">如果表达式1成立，则IF函数返回表达式2值，否则返回表达式3的值</span><br><span class="line"></span><br><span class="line">应用：任何地方</span><br><span class="line"></span><br><span class="line">#========================================================</span><br><span class="line"></span><br><span class="line">#2、case结构</span><br><span class="line"></span><br><span class="line">情况1：类似java中的switch语句，一般用于实现等值判断</span><br><span class="line">语法：</span><br><span class="line">	CASE 变量|表达式|字段 </span><br><span class="line">	WHEN 取值1 THEN 返回值|操作语句1</span><br><span class="line">	WHEN 取值2 THEN 返回值|操作语句2</span><br><span class="line">	...</span><br><span class="line">	ELSE 默认返回值|操作语句</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">情况2：类似java中的多重IF语句，一般用于实现区间判断</span><br><span class="line">语法：</span><br><span class="line">	CASE</span><br><span class="line">	WHEN 要判断的条件1 THEN 返回值|操作语句1</span><br><span class="line">	WHEN 要判断的条件2 THEN 返回值|操作语句2</span><br><span class="line">	...</span><br><span class="line">	ELSE 默认返回值|操作语句</span><br><span class="line">	END</span><br><span class="line">	</span><br><span class="line">特点：</span><br><span class="line">1.</span><br><span class="line">可以作为表达式，嵌套在其他语句中使用，可以放在任何在方，BEGIN END中或外面 </span><br><span class="line">可以作为独立的语句去使用，只能放在BEGIN END中:/*</span><br><span class="line">情况1：类似java中的switch语句，一般用于实现等值判断</span><br><span class="line">语法：</span><br><span class="line">	CASE 变量|表达式|字段 </span><br><span class="line">	WHEN 取值1 THEN 操作语句1;</span><br><span class="line">	WHEN 取值2 THEN 操作语句2;</span><br><span class="line">	...</span><br><span class="line">	ELSE 默认操作语句;</span><br><span class="line">	END CASE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">情况2：类似java中的多重IF语句，一般用于实现区间判断</span><br><span class="line">语法：</span><br><span class="line">	CASE</span><br><span class="line">	WHEN 要判断的条件1 THEN 操作语句1;</span><br><span class="line">	WHEN 要判断的条件2 THEN 操作语句2;</span><br><span class="line">	...</span><br><span class="line">	ELSE 默认操作语句;</span><br><span class="line">	END CASE;</span><br><span class="line">*/</span><br><span class="line">2.</span><br><span class="line">如果WHEN中的值满足或条件成立，则执行对应的THEN后面的语句，并且结束CASE</span><br><span class="line">如果都不满足，则执行ELSE中的语句或值</span><br><span class="line">3.</span><br><span class="line">ELSE可以省略，如果所有的WHEN判断都不满足且ELSE省略，则返回NULL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例</span><br><span class="line">## 创建存储过程，根据传入的成绩，来显示等级，比如传入的成绩：</span><br><span class="line">## 90-100：A; 80-90:B; 60-80:C; 其它：D</span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line">CREATE PROCEDURE test_case(IN score INT)</span><br><span class="line">BEGIN</span><br><span class="line">	CASE </span><br><span class="line">	WHEN score &gt;= 90 AND score &lt;= 100 THEN SELECT &#x27;A&#x27;;</span><br><span class="line">	WHEN score &gt;= 80 THEN SELECT &#x27;B&#x27;;</span><br><span class="line">	WHEN score &gt;= 60 THEN SELECT &#x27;C&#x27;;</span><br><span class="line">	ELSE SELECT &#x27;D&#x27;;</span><br><span class="line">	END CASE;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">CALL test_case(95) $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#========================================================</span><br><span class="line"></span><br><span class="line">#3、if结构</span><br><span class="line"></span><br><span class="line">功能：实现多重分支</span><br><span class="line">语法;</span><br><span class="line">IF 条件1 THEN 语句1;</span><br><span class="line">ELSEIF 条件2 THEN 语句2;</span><br><span class="line">ELSEIF 条件3 THEN 语句3;</span><br><span class="line">...</span><br><span class="line">【ELSE 语句n;】</span><br><span class="line">END IF;</span><br><span class="line"></span><br><span class="line">应用场合：</span><br><span class="line">只能在BEGIN END中</span><br><span class="line"></span><br><span class="line">#案例1:</span><br><span class="line">## 创建存储过程，根据传入的成绩，返回等级，比如传入的成绩：</span><br><span class="line">## 90-100：A; 80-90:B; 60-80:C; 其它：D</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION test_if(score INT) RETURNS CHAR</span><br><span class="line">BEGIN</span><br><span class="line">	IF score &gt;= 90 AND score &lt;= 100 THEN RETURN &#x27;A&#x27;;</span><br><span class="line">	ELSEIF score &gt;= 80 THEN RETURN &#x27;B&#x27;;</span><br><span class="line">	ELSEIF score &gt;= 60 THEN RETURN &#x27;C&#x27;;</span><br><span class="line">	ELSE RETURN &#x27;D&#x27;;</span><br><span class="line">	END IF;</span><br><span class="line">END$</span><br><span class="line"></span><br><span class="line">SELECT test_if(85)$</span><br><span class="line"></span><br><span class="line">#=============================================================</span><br><span class="line">#=============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#二、循环结构</span><br><span class="line">分类：</span><br><span class="line">WHILE, LOOP, REPEAT</span><br><span class="line"></span><br><span class="line">循环控制语句：</span><br><span class="line">ITERATE：类似于CONTINUE,结束本次循环，继续下一次</span><br><span class="line">LEAVE：类似于break，跳出循环</span><br><span class="line"></span><br><span class="line">应用位置：只用在begin end中</span><br><span class="line"></span><br><span class="line">对比：</span><br><span class="line">1、这3种循环都可以省略标签，但如果要想在循环体中添加循环控制语句（leave, iterate)则必须添加标签</span><br><span class="line">2、</span><br><span class="line">loop：用于实现简单的死循环</span><br><span class="line">while：先判断，后执行；循环体可以一次都不执行</span><br><span class="line">repeat：先执行，后判断；循环体无条件至少执行一次</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#1、while</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">【标签：】WHILE 循环条件 DO</span><br><span class="line">	循环体;</span><br><span class="line">END WHILE 【标签】;</span><br><span class="line"></span><br><span class="line">#=============================================================</span><br><span class="line"></span><br><span class="line">#2、loop</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">【标签：】LOOP</span><br><span class="line">	循环体;</span><br><span class="line">END LOOP 【标签】;</span><br><span class="line">可以用来模拟简单的死循环</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#=============================================================</span><br><span class="line"></span><br><span class="line">#3、repeat</span><br><span class="line"></span><br><span class="line">语法：</span><br><span class="line">【标签：】REPEAT</span><br><span class="line">	循环体;</span><br><span class="line">UNTIL 结束循环的条件</span><br><span class="line">END REPEAT 【标签】;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#==============================================================</span><br><span class="line"></span><br><span class="line">##没有添加循环控制语句</span><br><span class="line"></span><br><span class="line">#案例1：批量插入，根据次数插入到admin表中多条记录</span><br><span class="line"></span><br><span class="line">USE girls$</span><br><span class="line">CREATE PROCEDURE pro_while1(IN insertCount INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE i INT DEFAULT 1;</span><br><span class="line">	WHILE i &lt;= insertCount DO</span><br><span class="line">		INSERT INTO admin(username, PASSWORD)</span><br><span class="line">		VALUES(CONCAT(&#x27;Rose&#x27;,i), &#x27;666&#x27;);</span><br><span class="line">		SET i = i+1;</span><br><span class="line">	END WHILE;</span><br><span class="line"></span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">CALL pro_while1(100)$</span><br><span class="line">SELECT * FROM admin$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##添加循环控制语句</span><br><span class="line"></span><br><span class="line">#添加leave</span><br><span class="line">#案例2：批量插入，根据次数插入到admin中多条记录，如果次数大于20则停止</span><br><span class="line">TRUNCATE TABLE admin$</span><br><span class="line">DROP PROCEDURE pro_while1$</span><br><span class="line">CREATE PROCEDURE pro_while1(IN insertCount INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE i INT DEFAULT 1;</span><br><span class="line">	a:WHILE i &lt;= insertCount DO</span><br><span class="line">		INSERT INTO admin(username, PASSWORD)</span><br><span class="line">		VALUES(CONCAT(&#x27;xiaohua&#x27;,i), &#x27;0000&#x27;);</span><br><span class="line">		IF i &gt;= 20 THEN LEAVE a; -- 循环控制语句必须要给循环起标签</span><br><span class="line">		END IF;</span><br><span class="line">		SET i = i+1;</span><br><span class="line">	END WHILE a;</span><br><span class="line">END$</span><br><span class="line"></span><br><span class="line">CALL pro_while1(100)$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#添加iterate</span><br><span class="line">#案例3：批量插入，根据次数插入到admin中多条记录，只插入偶数次</span><br><span class="line">TRUNCATE TABLE admin$</span><br><span class="line">DROP PROCEDURE pro_while1$</span><br><span class="line">CREATE PROCEDURE pro_while1(IN insertCount INT)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE i INT DEFAULT 0;</span><br><span class="line">	a:WHILE i &lt;= insertCount DO</span><br><span class="line">		SET i = i + 1;</span><br><span class="line">		IF MOD(i,2) &lt;&gt; 0 THEN ITERATE a;</span><br><span class="line">		END IF;</span><br><span class="line">		INSERT INTO admin(username, PASSWORD)</span><br><span class="line">		VALUES(CONCAT(&#x27;xiaohua&#x27;,i), &#x27;0000&#x27;);</span><br><span class="line">	END WHILE a;</span><br><span class="line">END$</span><br><span class="line"></span><br><span class="line">CALL pro_while1(100)$</span><br><span class="line">SELECT * FROM admin$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#=========================================================================</span><br><span class="line"></span><br><span class="line">###案例</span><br><span class="line">/*</span><br><span class="line">创建一个表，字段包括：</span><br><span class="line">id 自增长</span><br><span class="line">content varchar(20)</span><br><span class="line"></span><br><span class="line">向该表中插入指定个数的，随机的字符串</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE stringcontent(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	content VARCHAR(20)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE test_randstr_insert(IN insertCount INT)</span><br><span class="line">BEGIN </span><br><span class="line">	DECLARE i INT DEFAULT 1; -- 定义一个循环变量，表示插入次数</span><br><span class="line">	DECLARE str VARCHAR(26) DEFAULT &#x27;abcdefghijklmnopqrstuvwxyz&#x27;; -- 随机字符串产生源</span><br><span class="line">	DECLARE startindex INT DEFAULT 1; -- 代表随机字符串起始索引</span><br><span class="line">	DECLARE len INT DEFAULT 1; -- 随机字符串长度</span><br><span class="line">	WHILE i&lt;= insertCount DO</span><br><span class="line">		SET len = FLOOR(RAND()*IF((20-startindex+1)&lt;0, -1*(20-startindex+1),(20-startindex+1))) + 1;</span><br><span class="line">		SET startindex = FLOOR(RAND()*26) + 1;</span><br><span class="line">		INSERT INTO stringcontent(content) VALUES(SUBSTR(str, startindex, len));</span><br><span class="line">		SET i = i + 1;		</span><br><span class="line">	END WHILE;</span><br><span class="line">END $</span><br><span class="line"></span><br><span class="line">CALL test_randstr_insert(10)$</span><br><span class="line"></span><br><span class="line">SELECT * FROM stringcontent$</span><br></pre></td></tr></table></figure>







</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-10-16</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Database/" title="Database">Database </a><a class="tag" href="/tags/sql/" title="sql">sql </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://example.com/2023/10/16/MySQL基础/,Jacob Fang,Mysql基础,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2023/10/16/hello-world/" title="Hello World">上一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>